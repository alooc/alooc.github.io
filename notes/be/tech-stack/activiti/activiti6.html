<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>activiti6笔记 | Alooc</title>
    <meta name="description" content="Alooc的博客">
    <meta name="generator" content="VitePress v1.6.3">
    <link rel="preload stylesheet" href="/assets/style.BEKjzdOg.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.C8jyHUZW.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.u9DeBbCr.js">
    <link rel="modulepreload" href="/assets/chunks/framework.DPDPlp3K.js">
    <link rel="modulepreload" href="/assets/notes_be_tech-stack_activiti_activiti6.md.4j5kN20m.lean.js">
    <link rel="icon" href="/logo.png">
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-4e0580c9><!--[--><!--]--><!--[--><span tabindex="-1" data-v-76b2d3b6></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-76b2d3b6>Skip to content</a><!--]--><!----><header class="VPNav" data-v-4e0580c9 data-v-65aa0d71><div class="VPNavBar" data-v-65aa0d71 data-v-a22fa644><div class="wrapper" data-v-a22fa644><div class="container" data-v-a22fa644><div class="title" data-v-a22fa644><div class="VPNavBarTitle has-sidebar" data-v-a22fa644 data-v-023504db><a class="title" href="/" data-v-023504db><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.png" alt data-v-410bb4c7><!--]--><span data-v-023504db>Alooc</span><!--[--><!--]--></a></div></div><div class="content" data-v-a22fa644><div class="content-body" data-v-a22fa644><!--[--><!--]--><div class="VPNavBarSearch search" data-v-a22fa644><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-a22fa644 data-v-589d1911><span id="main-nav-aria-label" class="visually-hidden" data-v-589d1911> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-589d1911 data-v-1a93f4bf><!--[--><span data-v-1a93f4bf>首页</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-589d1911 data-v-c9f6b993><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-c9f6b993><span class="text" data-v-c9f6b993><!----><span data-v-c9f6b993>我的笔记</span><span class="vpi-chevron-down text-icon" data-v-c9f6b993></span></span></button><div class="menu" data-v-c9f6b993><div class="VPMenu" data-v-c9f6b993 data-v-b5c661f9><div class="items" data-v-b5c661f9><!--[--><!--[--><div class="VPMenuGroup" data-v-b5c661f9 data-v-36a488f5><p class="title" data-v-36a488f5>基础</p><!--[--><!--[--><div class="VPMenuLink" data-v-36a488f5 data-v-49b2c322><a class="VPLink link" href="/notes/basics/algo/algo-metrics-and-sorting.html" data-v-49b2c322><!--[--><span data-v-49b2c322>算法</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-36a488f5 data-v-49b2c322><a class="VPLink link" href="/notes/basics/database/mysql/" data-v-49b2c322><!--[--><span data-v-49b2c322>数据库</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-36a488f5 data-v-49b2c322><a class="VPLink link" href="/notes/basics/lang/java/" data-v-49b2c322><!--[--><span data-v-49b2c322>编程语言</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuGroup" data-v-b5c661f9 data-v-36a488f5><p class="title" data-v-36a488f5>后端</p><!--[--><!--[--><div class="VPMenuLink" data-v-36a488f5 data-v-49b2c322><a class="VPLink link" href="/notes/be/frame/spring/spring/" data-v-49b2c322><!--[--><span data-v-49b2c322>框架</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-36a488f5 data-v-49b2c322><a class="VPLink link" href="/notes/be/middleware/rabbitmq/rabbitmq.html" data-v-49b2c322><!--[--><span data-v-49b2c322>中间件</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-36a488f5 data-v-49b2c322><a class="VPLink link" href="/notes/be/tech-stack/design-pattern.html" data-v-49b2c322><!--[--><span data-v-49b2c322>技术栈</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--[--><div class="VPMenuLink" data-v-b5c661f9 data-v-49b2c322><a class="VPLink link" href="/notes/fe/data-visualization/instruction.html" data-v-49b2c322><!--[--><span data-v-49b2c322>前端</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-589d1911 data-v-c9f6b993><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-c9f6b993><span class="text" data-v-c9f6b993><!----><span data-v-c9f6b993>项目实践</span><span class="vpi-chevron-down text-icon" data-v-c9f6b993></span></span></button><div class="menu" data-v-c9f6b993><div class="VPMenu" data-v-c9f6b993 data-v-b5c661f9><div class="items" data-v-b5c661f9><!--[--><!--[--><div class="VPMenuLink" data-v-b5c661f9 data-v-49b2c322><a class="VPLink link" href="/projects/preview/markdown-examples.html" data-v-49b2c322><!--[--><span data-v-49b2c322>在线预览</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b5c661f9 data-v-49b2c322><a class="VPLink link" href="/projects/mall/" data-v-49b2c322><!--[--><span data-v-49b2c322>商城系统</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-589d1911 data-v-c9f6b993><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-c9f6b993><span class="text" data-v-c9f6b993><!----><span data-v-c9f6b993>参考资料</span><span class="vpi-chevron-down text-icon" data-v-c9f6b993></span></span></button><div class="menu" data-v-c9f6b993><div class="VPMenu" data-v-c9f6b993 data-v-b5c661f9><div class="items" data-v-b5c661f9><!--[--><!--[--><div class="VPMenuLink" data-v-b5c661f9 data-v-49b2c322><a class="VPLink link" href="/refs/blogs/" data-v-49b2c322><!--[--><span data-v-49b2c322>博客</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b5c661f9 data-v-49b2c322><a class="VPLink link" href="/refs/docs/" data-v-49b2c322><!--[--><span data-v-49b2c322>文档</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-b5c661f9 data-v-49b2c322><a class="VPLink link" href="/refs/tutorials/" data-v-49b2c322><!--[--><span data-v-49b2c322>教程</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/about/me/" tabindex="0" data-v-589d1911 data-v-1a93f4bf><!--[--><span data-v-1a93f4bf>关于我</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-a22fa644 data-v-ae201a57><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-ae201a57 data-v-2d6d62a8 data-v-f3e9724b><span class="check" data-v-f3e9724b><span class="icon" data-v-f3e9724b><!--[--><span class="vpi-sun sun" data-v-2d6d62a8></span><span class="vpi-moon moon" data-v-2d6d62a8></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-a22fa644 data-v-819269e2 data-v-8e2750ee><!--[--><a class="VPSocialLink no-icon" href="https://github.com/alooc" aria-label="github" target="_blank" rel="noopener" data-v-8e2750ee data-v-14a72ee3><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-a22fa644 data-v-13e0a807 data-v-c9f6b993><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-c9f6b993><span class="vpi-more-horizontal icon" data-v-c9f6b993></span></button><div class="menu" data-v-c9f6b993><div class="VPMenu" data-v-c9f6b993 data-v-b5c661f9><!----><!--[--><!--[--><!----><div class="group" data-v-13e0a807><div class="item appearance" data-v-13e0a807><p class="label" data-v-13e0a807>Appearance</p><div class="appearance-action" data-v-13e0a807><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-13e0a807 data-v-2d6d62a8 data-v-f3e9724b><span class="check" data-v-f3e9724b><span class="icon" data-v-f3e9724b><!--[--><span class="vpi-sun sun" data-v-2d6d62a8></span><span class="vpi-moon moon" data-v-2d6d62a8></span><!--]--></span></span></button></div></div></div><div class="group" data-v-13e0a807><div class="item social-links" data-v-13e0a807><div class="VPSocialLinks social-links-list" data-v-13e0a807 data-v-8e2750ee><!--[--><a class="VPSocialLink no-icon" href="https://github.com/alooc" aria-label="github" target="_blank" rel="noopener" data-v-8e2750ee data-v-14a72ee3><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-a22fa644 data-v-2fa31341><span class="container" data-v-2fa31341><span class="top" data-v-2fa31341></span><span class="middle" data-v-2fa31341></span><span class="bottom" data-v-2fa31341></span></span></button></div></div></div></div><div class="divider" data-v-a22fa644><div class="divider-line" data-v-a22fa644></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-4e0580c9 data-v-fc9b0a19><div class="container" data-v-fc9b0a19><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-fc9b0a19><span class="vpi-align-left menu-icon" data-v-fc9b0a19></span><span class="menu-text" data-v-fc9b0a19>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-fc9b0a19 data-v-66ef8359><button data-v-66ef8359>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-4e0580c9 data-v-cc53676b><div class="curtain" data-v-cc53676b></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-cc53676b><span class="visually-hidden" id="sidebar-aria-label" data-v-cc53676b> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-3f33125d><section class="VPSidebarItem level-0" data-v-3f33125d data-v-178d1c1e><div class="item" role="button" tabindex="0" data-v-178d1c1e><div class="indicator" data-v-178d1c1e></div><h2 class="text" data-v-178d1c1e>技术栈</h2><!----></div><div class="items" data-v-178d1c1e><!--[--><section class="VPSidebarItem level-1" data-v-178d1c1e data-v-178d1c1e><div class="item" role="button" tabindex="0" data-v-178d1c1e><div class="indicator" data-v-178d1c1e></div><h3 class="text" data-v-178d1c1e>工具</h3><!----></div><div class="items" data-v-178d1c1e><!--[--><div class="VPSidebarItem level-2 is-link" data-v-178d1c1e data-v-178d1c1e><div class="item" data-v-178d1c1e><div class="indicator" data-v-178d1c1e></div><a class="VPLink link link" href="/notes/be/tech-stack/tool/vitepress-blog.html" data-v-178d1c1e><!--[--><p class="text" data-v-178d1c1e>搭建vitepress博客</p><!--]--></a><!----></div><!----></div><!--]--></div></section><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-4e0580c9 data-v-8233baff><div class="VPDoc has-sidebar has-aside" data-v-8233baff data-v-3ddcd6ca><!--[--><!--]--><div class="container" data-v-3ddcd6ca><div class="aside" data-v-3ddcd6ca><div class="aside-curtain" data-v-3ddcd6ca></div><div class="aside-container" data-v-3ddcd6ca><div class="aside-content" data-v-3ddcd6ca><div class="VPDocAside" data-v-3ddcd6ca data-v-dea7a18d><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-dea7a18d data-v-7824067e><div class="content" data-v-7824067e><div class="outline-marker" data-v-7824067e></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-7824067e>页面导航</div><ul class="VPDocOutlineItem root" data-v-7824067e data-v-d0385b5f><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-dea7a18d></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-3ddcd6ca><div class="content-container" data-v-3ddcd6ca><!--[--><!--]--><main class="main" data-v-3ddcd6ca><div style="position:relative;" class="vp-doc _notes_be_tech-stack_activiti_activiti6" data-v-3ddcd6ca><div><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>first-demo：</span></span>
<span class="line"><span>步骤：设计流程，配置流程引擎，加载流程文件，启动流程。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>数据库表的含义</span></span>
<span class="line"><span>url driver user password</span></span>
<span class="line"><span></span></span>
<span class="line"><span>配置文件</span></span>
<span class="line"><span></span></span>
<span class="line"><span>工作流引擎设计的一致原则是：强调流程服务的可嵌入性和可扩展性</span></span>
<span class="line"><span></span></span>
<span class="line"><span>jbpm3,jbpm5 activiti5:</span></span>
<span class="line"><span>	jBPM3 是一个完整的工作流系统实现，面向开发人员，</span></span>
<span class="line"><span>		目的在于简化对组织核心流程进行支撑的软件创建，不支持标准。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	jBPM4 引入 PVM，使其拥有更强大的扩展性，同时增加 BPMS 特性，</span></span>
<span class="line"><span>		这些特性包括了对 BPMN 的支持、面向业务人员的 Web 建模器和简单统计分析功能的加入。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	jBPM5 基于原先的 Drools Flow，支持 BPMN，通过与 Drools 的合并支持 BAM，</span></span>
<span class="line"><span>		通过内容仓库增加对流程可视化的支持。由于放弃了 jBPM4 的 PVM，引擎的可扩展性受到损害，并且不再支持 jPDL。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	Activiti5 基于 jBPM4，与 Alfresco 的集成增加了其流程可视化与管理能力，</span></span>
<span class="line"><span>		同时通过创新的 Activiti Cycle 协作组件支持流程相关人员之间的协调，最后，它加强了集成能力。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>******************************************************************</span></span>
<span class="line"><span>第一章 Activiti介绍</span></span>
<span class="line"><span>	BPMN   Business Process Modeling Notation  业务流程模型和符号</span></span>
<span class="line"><span>	BPMN 2.0 定义了5个基础的元素类别：</span></span>
<span class="line"><span>		流对象 Flow Object :在一个业务流程中，流对象是用于定义行为的图形元素，主要有事件Events、活动Activities、和网关 Gateways 三种流对象 </span></span>
<span class="line"><span>		数据 Data :主要有数据对象 Data Objects、数据输入 Data Inputs 、数据输出 Data Outputs 和数据存储 Data Stores 四种元素</span></span>
<span class="line"><span>		连接对象 Connecting Objects :用于连接流对象，顺序流 Sequence Flows、消息流 Message Flows、关联 Associations 和数据关联 Data Associations 四种连接流对象的方式</span></span>
<span class="line"><span>		泳道 Swimlanes :泳道提供了两种途径用于组织基础的模型元素，分别是池 Pools 和道 Lanes</span></span>
<span class="line"><span>		制品 Artifacts :制品主要用于为流程提供附加信息，当前制品包括组 Group 和 注释 Text Annotation</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第二章 安装运行Activiti</span></span>
<span class="line"><span>	开发第一个应用：</span></span>
<span class="line"><span>		1.引入jar包</span></span>
<span class="line"><span>		2.写配置文件 activiti的配置文件默认是resource中的activiti.cgf.xml</span></span>
<span class="line"><span>			示例：</span></span>
<span class="line"><span>				&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span>
<span class="line"><span>				&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span>				       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span>				       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span></span>
<span class="line"><span>					&lt;!-- 流程引擎配置的bean --&gt;</span></span>
<span class="line"><span>					&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>						class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>						&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act?useUnicode=true&amp;amp; characterEncoding=utf8&amp;amp; useSSL=false&amp;amp; serverTimezone=UTC&amp;amp; rewriteBatchedStatements=true&quot; /&gt;</span></span>
<span class="line"><span>						&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.cj.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>						&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>						&lt;property name=&quot;jdbcPassword&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>						&lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;true&quot; /&gt;</span></span>
<span class="line"><span>					&lt;/bean&gt;</span></span>
<span class="line"><span>				&lt;/beans&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		3.创建bpmn文件 </span></span>
<span class="line"><span>		4.类文件启动示例：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			// 创建流程引擎</span></span>
<span class="line"><span>			ProcessEngine engine = ProcessEngines.getDefaultProcessEngine();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		★//部署层面</span></span>
<span class="line"><span>			// 得到流程存储服务组件，相当于流程仓库，可部署流程，kickstart App</span></span>
<span class="line"><span>			RepositoryService repositoryService = engine.getRepositoryService();</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>		★//启动层面</span></span>
<span class="line"><span>			// 得到运行时服务组件，运行服务，启动流程  启动流程</span></span>
<span class="line"><span>			RuntimeService runtimeService = engine.getRuntimeService();</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>		★//流程处理层面</span></span>
<span class="line"><span>			// 获取流程任务组件    流程启动后，使用</span></span>
<span class="line"><span>			TaskService taskService = engine.getTaskService();</span></span>
<span class="line"><span>			// 部署流程文件</span></span>
<span class="line"><span>			repositoryService.createDeployment()</span></span>
<span class="line"><span>					.addClasspathResource(&quot;bpmn/First.bpmn&quot;).deploy();</span></span>
<span class="line"><span>			// 启动流程</span></span>
<span class="line"><span>			runtimeService.startProcessInstanceByKey(&quot;process1&quot;);</span></span>
<span class="line"><span>			// 查询第一个任务</span></span>
<span class="line"><span>			Task task = taskService.createTaskQuery().singleResult();</span></span>
<span class="line"><span>			System.out.println(&quot;第一个任务完成前，当前任务名称：&quot; + task.getName());</span></span>
<span class="line"><span>			// 完成第一个任务</span></span>
<span class="line"><span>			taskService.complete(task.getId());</span></span>
<span class="line"><span>			// 查询第二个任务</span></span>
<span class="line"><span>			task = taskService.createTaskQuery().singleResult();</span></span>
<span class="line"><span>			System.out.println(&quot;第二个任务完成前，当前任务名称：&quot; + task.getName());</span></span>
<span class="line"><span>			// 完成第二个任务（流程结束）</span></span>
<span class="line"><span>			taskService.complete(task.getId());</span></span>
<span class="line"><span>			task = taskService.createTaskQuery().singleResult();</span></span>
<span class="line"><span>			System.out.println(&quot;流程结束后，查找任务：&quot; + task);</span></span>
<span class="line"><span>			// 退出</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>第三章 Activiti数据库设计</span></span>
<span class="line"><span>	activiti流程引擎的数据表分为5大类，各类职责不同，有统一的命名规范</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	1.通用数据表：只存放通用资源， ACT_GE</span></span>
<span class="line"><span>		资源表 ACT_GE_BYTEARRAY </span></span>
<span class="line"><span>			保存与流程引擎相关的资源</span></span>
<span class="line"><span>			一般用来保存字符串、流程文件的内容、流程图片内容</span></span>
<span class="line"><span>		属性表 ACT_GE_PROPERTY</span></span>
<span class="line"><span>			属性的键值对</span></span>
<span class="line"><span>	2.流程存储表：保存流程定义和部署信息 ACT_RE</span></span>
<span class="line"><span>		部署数据表 ACT_RE_DEPLOYMENT</span></span>
<span class="line"><span>			保存部署信息</span></span>
<span class="line"><span>		流程定义表 ACT_RE_PROCDEF</span></span>
<span class="line"><span>			保存流程文件 .bpmn</span></span>
<span class="line"><span>	3.身份数据表：有关身份数据的几张表 ACT_ID</span></span>
<span class="line"><span>		用户表 ACT_ID_USER</span></span>
<span class="line"><span>			保存用户信息</span></span>
<span class="line"><span>		用户账号（信息）表 ACT_ID_INFO</span></span>
<span class="line"><span>			activiti将用户、用户账号和用户信息分三种数据，用户表保存用户的数据，</span></span>
<span class="line"><span>			而其他两个被保存在这个表中</span></span>
<span class="line"><span>		用户组表 ACT_ID_GROUP</span></span>
<span class="line"><span>			用户组数据（组名称，组类型）</span></span>
<span class="line"><span>		关系表 ACT_ID_MEMBERSHIP</span></span>
<span class="line"><span>			保存用户属于哪个组</span></span>
<span class="line"><span>	4.运行时数据表：保存流程在运行过程中所产生的数据，例如流程实例、执行流、任务等 ACT_RU</span></span>
<span class="line"><span>		流程实例（执行流）表 ACT_RU_EXECUTION</span></span>
<span class="line"><span>		流程任务表 ACT_RU_TASK</span></span>
<span class="line"><span>		流程参数表 ACT_RU_VARIABLE</span></span>
<span class="line"><span>		流程与身份关系表 ACT_RU_IDENTITYLINK</span></span>
<span class="line"><span>		工作数据表</span></span>
<span class="line"><span>			ACT_RU_JOB</span></span>
<span class="line"><span>			ACT_RU_DEADLEFTER_JOB</span></span>
<span class="line"><span>			ACT_RU_SUSPENDED_JOB</span></span>
<span class="line"><span>			ACT_RU_TIMER_JOB</span></span>
<span class="line"><span>		事件描述表 ACT_RU_EVENT_SUBSCR</span></span>
<span class="line"><span>	5.历史数据表：流程引擎的日志表，操作过的流程元素将会被记录到历史表中 ACT_HI</span></span>
<span class="line"><span>		流程实例表 ACT_HI_PROCINST</span></span>
<span class="line"><span>		流程明细表 ACT_HI_DETAIL</span></span>
<span class="line"><span>		历史任务表和历史行为表 ACT_HI_TASKINST</span></span>
<span class="line"><span>		附件表和评论表 ACT_HI_ATTACHMENT</span></span>
<span class="line"><span>	6.DMN 规则引擎表</span></span>
<span class="line"><span>		activiti6加入了DMN规范的规则引擎模块</span></span>
<span class="line"><span>			1.决策部署表  ACT_DMN_DEPLOYMENT</span></span>
<span class="line"><span>				类似于流程定义部署，每次部署，向部署表中写入部署数据</span></span>
<span class="line"><span>			2.决策表 ACT_DMN_DECISION_TABLE</span></span>
<span class="line"><span>				决策类似于流程定义，保存决策模型</span></span>
<span class="line"><span>			3.部署资源表 ACT_DMN_DEPLOYMENT_RESOURCE</span></span>
<span class="line"><span>				规则引擎相关的资源，例如决策文件、图片</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第四章 Activiti流程引擎配置</span></span>
<span class="line"><span>	1.流程引擎对象</span></span>
<span class="line"><span>		ProcessEngineConfiguration对象代表一个Activiti流程引擎的全部配置</span></span>
<span class="line"><span>			该对象的静态方法读取配置文件，生成实例</span></span>
<span class="line"><span>		1.</span></span>
<span class="line"><span>		/**</span></span>
<span class="line"><span>		 * 使用createProcessEngineConfigurationFromResourceDefault方法</span></span>
<span class="line"><span>		 * 创建ProcessEngineConfiguration实例</span></span>
<span class="line"><span>		 * @author Administrator</span></span>
<span class="line"><span>		 *</span></span>
<span class="line"><span>		 */</span></span>
<span class="line"><span>		//使用Activiti默认的方式创建ProcessEngineConfiguration</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResourceDefault();	</span></span>
<span class="line"><span>		2.</span></span>
<span class="line"><span>		/**</span></span>
<span class="line"><span>		 * 使用CreateProcessEngineConfigurationFromResource方法创建ProcessEngineConfiguration实例</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 * @author Administrator</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 */</span></span>
<span class="line"><span>		// 指定配置文件创建ProcessEngineConfiguration</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;my-activiti1.xml&quot;);</span></span>
<span class="line"><span>		3.</span></span>
<span class="line"><span>		/**</span></span>
<span class="line"><span>		 * 使用createProcessEngineConfigurationFromInputStream方法创建ProcessEngineConfiguration</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 * @author yangenxiong</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 */</span></span>
<span class="line"><span>		File file = new File(&quot;resource/input-stream.xml&quot;);</span></span>
<span class="line"><span>		// 得到文件输入流</span></span>
<span class="line"><span>		InputStream fis = new FileInputStream(file);</span></span>
<span class="line"><span>		// 使用createProcessEngineConfigurationFromInputStream方法创建ProcessEngineConfiguration</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromInputStream(fis);</span></span>
<span class="line"><span>		4.</span></span>
<span class="line"><span>		/**</span></span>
<span class="line"><span>		 * 使用createStandaloneInMemProcessEngineConfiguration创建ProcessEngineConfiguration</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 * @author yangenxiong</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 */</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createStandaloneInMemProcessEngineConfiguration();</span></span>
<span class="line"><span>		// 值为create-drop</span></span>
<span class="line"><span>		System.out.println(config.getDatabaseSchemaUpdate());</span></span>
<span class="line"><span>		// 值为jdbc:h2:mem:activiti</span></span>
<span class="line"><span>		System.out.println(config.getJdbcUrl());</span></span>
<span class="line"><span>		5.</span></span>
<span class="line"><span>		/**</span></span>
<span class="line"><span>		 * 使用CreateStandaloneProcessEngineConfiguration方法创建ProcessEngineConfiguration</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 * @author yangenxiong</span></span>
<span class="line"><span>		 * </span></span>
<span class="line"><span>		 */</span></span>
<span class="line"><span>		 ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createStandaloneProcessEngineConfiguration();</span></span>
<span class="line"><span>		// 默认值为 false</span></span>
<span class="line"><span>		System.out.println(config.getDatabaseSchemaUpdate());</span></span>
<span class="line"><span>		// 默认值为 jdbc:h2:tcp://localhost/~/activiti</span></span>
<span class="line"><span>		System.out.println(config.getJdbcUrl());</span></span>
<span class="line"><span>	2.数据源配置</span></span>
<span class="line"><span>	3.其他属性配置</span></span>
<span class="line"><span>		history配置</span></span>
<span class="line"><span>		asyncExecutorActivate配置</span></span>
<span class="line"><span>		邮件服务器配置</span></span>
<span class="line"><span>	示例：</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>		&lt;!-- 将databaseType设置为oracle --&gt;</span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>			class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcPassword&quot; value=&quot;123456&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;create-drop&quot;/&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;databaseType&quot; value=&quot;oracle&quot;/&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		// 读取Activiti配置</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;database-type.xml&quot;);</span></span>
<span class="line"><span>		// 启动Activiti</span></span>
<span class="line"><span>		ProcessEngine engine = config.buildProcessEngine();</span></span>
<span class="line"><span>		// 关闭流程引擎</span></span>
<span class="line"><span>		engine.close();</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>		&lt;!-- 使用C3P0数据源 --&gt;</span></span>
<span class="line"><span>		&lt;bean id=&quot;dataSource&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;driverClass&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;user&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;password&quot; value=&quot;123456&quot; /&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>			class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		// 读取c3p0-config.xml配置</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;config/c3p0-config.xml&quot;);</span></span>
<span class="line"><span>		// 能正常输出，即完成配置</span></span>
<span class="line"><span>		DataSource ds = config.getDataSource();</span></span>
<span class="line"><span>		// 查询数据库元信息，如果能查询则表示连接成功</span></span>
<span class="line"><span>		ds.getConnection().getMetaData();</span></span>
<span class="line"><span>		// 结果为 com.mchange.v2.c3p0.ComboPooledDataSource</span></span>
<span class="line"><span>		System.out.println(config.getDataSource().getClass().getName());</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		或者</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		&lt;!-- 不初始化任何属性 --&gt;</span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>			class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		// 创建C3P0数据源</span></span>
<span class="line"><span>		ComboPooledDataSource ds = new ComboPooledDataSource();</span></span>
<span class="line"><span>		// 设置JDBC连接的各个属性</span></span>
<span class="line"><span>		ds.setUser(&quot;root&quot;);</span></span>
<span class="line"><span>		ds.setPassword(&quot;123456&quot;);</span></span>
<span class="line"><span>		ds.setJdbcUrl(&quot;jdbc:mysql://localhost:3306/act&quot;);</span></span>
<span class="line"><span>		ds.setDriverClass(&quot;com.mysql.jdbc.Driver&quot;);</span></span>
<span class="line"><span>		// 验证是否连接成功</span></span>
<span class="line"><span>		ds.getConnection().getMetaData();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		// 读取Activiti配置文件</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;config/c3p0-coding.xml&quot;);</span></span>
<span class="line"><span>		// 为ProcessEngineConfiguration设置dataSource属性</span></span>
<span class="line"><span>		config.setDataSource(ds);</span></span>
<span class="line"><span>		System.out.println(config.getDataSource());</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>		&lt;!-- 将databaseSchemaUpdate设置为false --&gt;</span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>			class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcPassword&quot; value=&quot;123456&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;false&quot;/&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		//读取Activiti配置</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;schemaUpdate-false.xml&quot;);</span></span>
<span class="line"><span>		//启动Activiti</span></span>
<span class="line"><span>		config.buildProcessEngine();</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>		&lt;!-- 将databaseSchemaUpdate设置为true --&gt;</span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>			class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcPassword&quot; value=&quot;123456&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;true&quot;/&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		//读取Activiti配置</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;schemaUpdate-true.xml&quot;);</span></span>
<span class="line"><span>		System.out.println(config.getClass().getName());</span></span>
<span class="line"><span>		//启动Activiti</span></span>
<span class="line"><span>		config.buildProcessEngine();</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>		&lt;!-- 将databaseSchemaUpdate设置为create-drop --&gt;</span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>			class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcPassword&quot; value=&quot;123456&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;create-drop&quot;/&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		// 读取Activiti配置</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;schemaUpdate-create-drop.xml&quot;);</span></span>
<span class="line"><span>		// 启动Activiti</span></span>
<span class="line"><span>		ProcessEngine engine = config.buildProcessEngine();</span></span>
<span class="line"><span>		// 关闭流程引擎</span></span>
<span class="line"><span>		engine.close();</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>			class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcPassword&quot; value=&quot;123456&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;databaseSchemaUpdate&quot; value=&quot;true&quot;/&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;history&quot; value=&quot;activity&quot;/&gt;  activiti/audit/full/none/</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		// 读取Activiti配置</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;history-activity.xml&quot;);		</span></span>
<span class="line"><span>		//初始化流程引擎</span></span>
<span class="line"><span>		ProcessEngine engine = config.buildProcessEngine();</span></span>
<span class="line"><span>		//得到流程存储对象</span></span>
<span class="line"><span>		RepositoryService repositoryService = engine.getRepositoryService();</span></span>
<span class="line"><span>		//部署流程文件</span></span>
<span class="line"><span>		repositoryService.createDeployment().addClasspathResource(&quot;bpmn/history.bpmn20.xml&quot;).deploy();</span></span>
<span class="line"><span>		//得到运行服务对象</span></span>
<span class="line"><span>		RuntimeService runtimeService = engine.getRuntimeService();</span></span>
<span class="line"><span>		//创建参数</span></span>
<span class="line"><span>		Map&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();</span></span>
<span class="line"><span>		vars.put(&quot;day&quot;, 10);</span></span>
<span class="line"><span>		//开始流程</span></span>
<span class="line"><span>		ProcessInstance pi = runtimeService.startProcessInstanceByKey(&quot;vacationProcess&quot;, vars);</span></span>
<span class="line"><span>		System.exit(0);</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>		&lt;bean id=&quot;processEngineConfiguration&quot;</span></span>
<span class="line"><span>		class=&quot;org.activiti.engine.impl.cfg.StandaloneProcessEngineConfiguration&quot;&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUrl&quot; value=&quot;jdbc:mysql://localhost:3306/act&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcDriver&quot; value=&quot;com.mysql.jdbc.Driver&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcUsername&quot; value=&quot;root&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;jdbcPassword&quot; value=&quot;123456&quot; /&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;mailServerHost&quot; value=&quot;smtp.163.com&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;mailServerPort&quot; value=&quot;25&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;mailServerDefaultFrom&quot; value=&quot;yangenxiong@163.com&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;mailServerUsername&quot; value=&quot;yangenxiong@163.com&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span>			&lt;property name=&quot;mailServerPassword&quot; value=&quot;123456&quot;&gt;&lt;/property&gt;</span></span>
<span class="line"><span>		&lt;/bean&gt;</span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		************************************************************************************</span></span>
<span class="line"><span>	4.ProcessEngineCofiguration bean</span></span>
<span class="line"><span>		继承接口ProcessEngineCofiguration或ProcessEngineCofigurationImpl，</span></span>
<span class="line"><span>		自定义引擎启动类。</span></span>
<span class="line"><span>	5.Activiti的命令拦截器</span></span>
<span class="line"><span>		未学习</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第五章 流程引擎的创建</span></span>
<span class="line"><span>	和汽车发动机启动很像</span></span>
<span class="line"><span>	1.ProcessEngineConfiguration的buildProcessEngine方法创建</span></span>
<span class="line"><span>	先读后配，相当于配置检查</span></span>
<span class="line"><span>		// 读取配置</span></span>
<span class="line"><span>		ProcessEngineConfiguration config = ProcessEngineConfiguration</span></span>
<span class="line"><span>				.createProcessEngineConfigurationFromResource(&quot;build_engine.xml&quot;);</span></span>
<span class="line"><span>		// 创建ProcessEngine</span></span>
<span class="line"><span>		ProcessEngine engine = config.buildProcessEngine();</span></span>
<span class="line"><span>	2.ProcessEngines对象</span></span>
<span class="line"><span>		调用ProcessEngines的init方法</span></span>
<span class="line"><span>			// 初始化ProcessEngines的Map,</span></span>
<span class="line"><span>			// 再加载Activiti默认的配置文件（classpath下的activiti.cfg.xml文件）</span></span>
<span class="line"><span>			// 如果与Spring整合，则读取classpath下的activiti-context.xml文件</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			ProcessEngines.init();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			// 得到ProcessEngines的Map</span></span>
<span class="line"><span>			Map&lt;String, ProcessEngine&gt; engines = ProcessEngines.getProcessEngines();</span></span>
<span class="line"><span>			System.out.println(engines.size());</span></span>
<span class="line"><span>			System.out.println(engines.get(&quot;default&quot;));</span></span>
<span class="line"><span>		注册与注销ProcessEngine实例</span></span>
<span class="line"><span>			//读取自定义配置</span></span>
<span class="line"><span>			ProcessEngineConfiguration config = ProcessEngineConfiguration.</span></span>
<span class="line"><span>					createProcessEngineConfigurationFromResource(&quot;register.xml&quot;);</span></span>
<span class="line"><span>			//创建ProcessEngine实例</span></span>
<span class="line"><span>			ProcessEngine engine = config.buildProcessEngine();</span></span>
<span class="line"><span>			//获取ProcessEngine的Map</span></span>
<span class="line"><span>			Map&lt;String, ProcessEngine&gt; engines = ProcessEngines.getProcessEngines();</span></span>
<span class="line"><span>			System.out.println(&quot;注册后引擎数：&quot; + engines.size());</span></span>
<span class="line"><span>			//注销ProcessEngine实例</span></span>
<span class="line"><span>			ProcessEngines.unregister( engine);</span></span>
<span class="line"><span>			System.out.println(&quot;调用unregister后引擎数：&quot; + engines.size());</span></span>
<span class="line"><span>		使用ProcessEngines的retry方法</span></span>
<span class="line"><span>			//得到资源文件的URL实例</span></span>
<span class="line"><span>			ClassLoader cl = Retry.class.getClassLoader();</span></span>
<span class="line"><span>			URL url = cl.getResource(&quot;retry.xml&quot;);</span></span>
<span class="line"><span>			//调用retry方法创建ProcessEngine实例</span></span>
<span class="line"><span>			ProcessEngineInfo info = ProcessEngines.retry(url.toString());</span></span>
<span class="line"><span>			//得到流程实例保存对象</span></span>
<span class="line"><span>			Map&lt;String, ProcessEngine&gt; engines = ProcessEngines.getProcessEngines();</span></span>
<span class="line"><span>			System.out.println(&quot;调用retry方法后引擎数：&quot; + engines.size());	</span></span>
<span class="line"><span>		使用ProcessEngines的destroy方法</span></span>
<span class="line"><span>			// 进行初始化并且返回默认的ProcessEngine实例</span></span>
<span class="line"><span>			ProcessEngine engine = ProcessEngines.getDefaultProcessEngine();</span></span>
<span class="line"><span>			System.out.println(&quot;调用getDefaultProcessEngine方法后引擎数量：&quot;</span></span>
<span class="line"><span>					+ ProcessEngines.getProcessEngines().size());</span></span>
<span class="line"><span>			// 调用销毁方法</span></span>
<span class="line"><span>			ProcessEngines.destroy();</span></span>
<span class="line"><span>			// 最终结果为0</span></span>
<span class="line"><span>			System.out.println(&quot;调用destroy方法后引擎数量：&quot;</span></span>
<span class="line"><span>					+ ProcessEngines.getProcessEngines().size());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			// 得到资源文件的URL实例</span></span>
<span class="line"><span>			ClassLoader cl = Destroy.class.getClassLoader();</span></span>
<span class="line"><span>			URL url = cl.getResource(&quot;activiti.cfg.xml&quot;);</span></span>
<span class="line"><span>			// 调用retry方法创建ProcessEngine实例</span></span>
<span class="line"><span>			ProcessEngines.retry(url.toString());</span></span>
<span class="line"><span>			System.out.println(&quot;只调用 retry方法后引擎数量：&quot;</span></span>
<span class="line"><span>					+ ProcessEngines.getProcessEngines().size());</span></span>
<span class="line"><span>			// 调用销毁方法，没有效果</span></span>
<span class="line"><span>			ProcessEngines.destroy();</span></span>
<span class="line"><span>			System.out.println(&quot;调用destory无效果，引擎数量：&quot;</span></span>
<span class="line"><span>					+ ProcessEngines.getProcessEngines().size());</span></span>
<span class="line"><span>	3.ProcessEngine对象</span></span>
<span class="line"><span>		一个ProcessEngine实例代表一个流程引擎，实例中保存着各个服务组件的实例，根据这些服务组件，可以操作流程实例</span></span>
<span class="line"><span>		、任务、系统角色等数据。</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		1.服务组件：</span></span>
<span class="line"><span>			好像J2EE的Service层，通过getXXXService方法得到实例</span></span>
<span class="line"><span>			包含的实例：</span></span>
<span class="line"><span>				RespositoryService:提供一系列管理流程定义和流程部署的API</span></span>
<span class="line"><span>				RuntimeService:在流程运行时对流程实例进行管理与控制</span></span>
<span class="line"><span>				TaskService:对流程任务进行管理，例如任务提醒、任务完成和创建任务等</span></span>
<span class="line"><span>				IdentityService:提供对流程角色数据进行管理的API，这些角色数据包括用户组、用户及它们之间的关系</span></span>
<span class="line"><span>				ManagementService:提供对流程引擎进行管理和维护的服务</span></span>
<span class="line"><span>				HistoryService:对流程的历史数据进行操作，包括查询、删除这些历史数据</span></span>
<span class="line"><span>				DynamicBpmnService:使用该服务，可以不需要重新部署流程模型，就可以实现对流程模型的修改</span></span>
<span class="line"><span>		2.关闭流程引擎：</span></span>
<span class="line"><span>			engine.close();</span></span>
<span class="line"><span>			根据配置中databaseSchemeUpdate属性判断是否删除数据库	</span></span>
<span class="line"><span>		3.流程引擎名称:</span></span>
<span class="line"><span>			默认名称时default</span></span>
<span class="line"><span>			使用config.setProcessEngineName(&quot;test&quot;);</span></span>
<span class="line"><span>			示例：</span></span>
<span class="line"><span>				ProcessEngineConfiguration config = ProcessEngineConfiguration.</span></span>
<span class="line"><span>				createProcessEngineConfigurationFromResource(&quot;name.xml&quot;);</span></span>
<span class="line"><span>				//设置流程引擎名称</span></span>
<span class="line"><span>				config.setProcessEngineName(&quot;test&quot;);</span></span>
<span class="line"><span>				ProcessEngine engine = config.buildProcessEngine();</span></span>
<span class="line"><span>				//根据名称查询流程引擎</span></span>
<span class="line"><span>				ProcessEngine engineTest = ProcessEngines.getProcessEngine(&quot;test&quot;);</span></span>
<span class="line"><span>				System.out.println(&quot;创建的引擎实例：&quot; + engine);</span></span>
<span class="line"><span>				System.out.println(&quot;查询的引擎实例：&quot; + engineTest);</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>第六章 用户组与用户</span></span>
<span class="line"><span>	1.用户组管理：</span></span>
<span class="line"><span>		1.Group对象：</span></span>
<span class="line"><span>			通过业务层组件去创建</span></span>
<span class="line"><span>			IdentityService</span></span>
<span class="line"><span>		2.创建用户组：</span></span>
<span class="line"><span>			id,name,type 然后保存，</span></span>
<span class="line"><span>				技巧：group.setId(null) 可以让数据库自动生成主键id</span></span>
<span class="line"><span>		3.修改用户组：</span></span>
<span class="line"><span>			setter</span></span>
<span class="line"><span>		4.删除用户组：</span></span>
<span class="line"><span>			deleteGroup(id)</span></span>
<span class="line"><span>	2.Activiti数据查询：</span></span>
<span class="line"><span>		Activiti提供了一套数据查询API供开发者使用，可以使用各个服务组件的createXXXQuery方法来获取这些查询对象。</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		1.查询对象：</span></span>
<span class="line"><span>			Query是多有查询对象的父接口，提供了很多基础的方法：</span></span>
<span class="line"><span>				asc	设置查询结果的排序方式为升序</span></span>
<span class="line"><span>				count	计算查询结果的数据量</span></span>
<span class="line"><span>				desc	降序</span></span>
<span class="line"><span>				list	封装查询结果，返回相应类型的集合</span></span>
<span class="line"><span>				listPage	分页返回查询结果</span></span>
<span class="line"><span>				singleResult	查询单条符合条件的数据，没有返回null,多条抛出异常</span></span>
<span class="line"><span>		2.list方法：</span></span>
<span class="line"><span>			// 使用list方法查询全部的部署数据</span></span>
<span class="line"><span>			List&lt;Group&gt; datas = identityService.createGroupQuery().list();</span></span>
<span class="line"><span>		3.listPage方法：</span></span>
<span class="line"><span>			//调用listPage方法，从索引为2的记录开始，查询3条记录</span></span>
<span class="line"><span>			List&lt;Group&gt; datas = identityService.createGroupQuery().listPage(2, 3);</span></span>
<span class="line"><span>		4.count方法：</span></span>
<span class="line"><span>			// 使用list方法查询全部的部署数据</span></span>
<span class="line"><span>			long size = identityService.createGroupQuery().count();</span></span>
<span class="line"><span>		5.排序方法：</span></span>
<span class="line"><span>			List&lt;Group&gt; datas = identityService.createGroupQuery().orderByGroupName().asc().list();</span></span>
<span class="line"><span>		6.ID排序问题：</span></span>
<span class="line"><span>			主键均是字符型，排序要额外处理</span></span>
<span class="line"><span>		7.多字段排序：</span></span>
<span class="line"><span>			List&lt;Group&gt; datas = identityService.createGroupQuery()</span></span>
<span class="line"><span>				.orderByGroupId().desc()</span></span>
<span class="line"><span>				.orderByGroupName().asc().list();</span></span>
<span class="line"><span>		8.singleResult方法</span></span>
<span class="line"><span>		9.用户组数据查询：</span></span>
<span class="line"><span>			相应的数据查询对象除了拥有基类的方法，还有自己的方法：</span></span>
<span class="line"><span>			// groupId方法</span></span>
<span class="line"><span>			Group groupA = identityService.createGroupQuery().groupId(aId).singleResult();</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// groupName方法</span></span>
<span class="line"><span>			Group groupB = identityService.createGroupQuery().groupName(&quot;GroupB&quot;).singleResult();</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// groupType方法</span></span>
<span class="line"><span>			Group groupC = identityService.createGroupQuery().groupType(&quot;typeC&quot;).singleResult();</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// groupNameLike方法</span></span>
<span class="line"><span>			List&lt;Group&gt; groups = identityService.createGroupQuery().groupNameLike(&quot;%group%&quot;).list();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		10.原生SQL查询：</span></span>
<span class="line"><span>			createNativeGroupQuery()</span></span>
<span class="line"><span>			groups = identityService.createNativeGroupQuery()</span></span>
<span class="line"><span>				.sql(&quot;select * from ACT_ID_GROUP where NAME_ = #{name}&quot;)</span></span>
<span class="line"><span>				.parameter(&quot;name&quot;, &quot;GroupD&quot;).list();</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	3.用户管理：</span></span>
<span class="line"><span>		User对象</span></span>
<span class="line"><span>		添加用户 newUser  saveUser</span></span>
<span class="line"><span>		修改用户</span></span>
<span class="line"><span>		删除用户</span></span>
<span class="line"><span>		验证用户密码 checkPassWord  是用户密码，不是用户的账号密码</span></span>
<span class="line"><span>		用户数据查询 UserQuery对象</span></span>
<span class="line"><span>		设置认证用户 setAuthenticatedUserId 多线程中使用</span></span>
<span class="line"><span>	4.用户信息管理：</span></span>
<span class="line"><span>		添加和删除用户信息：</span></span>
<span class="line"><span>			用为ACT_ID_INFO数据结构是key-value，没有查询对象,通过id+key可以查到记录</span></span>
<span class="line"><span>			setUserInfo(String userId,String key,String value)</span></span>
<span class="line"><span>			deleteUserInfo(String userId,String key)</span></span>
<span class="line"><span>			示例：</span></span>
<span class="line"><span>				// 创建用户</span></span>
<span class="line"><span>				creatUser(identityService, id, &quot;angus&quot;, &quot;young&quot;, &quot;yangenxiong@163.com&quot;, &quot;abc&quot;);</span></span>
<span class="line"><span>				// 创建一个用户信息</span></span>
<span class="line"><span>				identityService.setUserInfo(id, &quot;age&quot;, &quot;30&quot;);</span></span>
<span class="line"><span>				// 创建第二个用户信息</span></span>
<span class="line"><span>				identityService.setUserInfo(id, &quot;weight&quot;, &quot;60KG&quot;);</span></span>
<span class="line"><span>				// 删除用户年龄信息</span></span>
<span class="line"><span>				identityService.deleteUserInfo(id, &quot;age&quot;);</span></span>
<span class="line"><span>		查询用户信息：</span></span>
<span class="line"><span>			getUserInfo(String userId,String key)</span></span>
<span class="line"><span>		设置用户图片：</span></span>
<span class="line"><span>			setUserPicture</span></span>
<span class="line"><span>			getUserPicture</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			先转为byte array，再存储，图片存放再资源表中，用户信息表存的是图片在的资源表的id</span></span>
<span class="line"><span>				// 读取图片并转换为byte数组</span></span>
<span class="line"><span>				FileInputStream fis = new FileInputStream(new File(&quot;resource/artifact/picture.png&quot;));		</span></span>
<span class="line"><span>				BufferedImage img = ImageIO.read(fis);</span></span>
<span class="line"><span>				ByteArrayOutputStream output = new ByteArrayOutputStream();</span></span>
<span class="line"><span>				ImageIO.write(img, &quot;png&quot;, output);</span></span>
<span class="line"><span>				//获取图片的byte数组</span></span>
<span class="line"><span>				byte[] picArray = output.toByteArray();		</span></span>
<span class="line"><span>				// 创建Picture实例</span></span>
<span class="line"><span>				Picture picture = new Picture(picArray, &quot;angus image&quot;);</span></span>
<span class="line"><span>				// 为用户设置图片</span></span>
<span class="line"><span>				identityService.setUserPicture(id, picture);	</span></span>
<span class="line"><span>	5.用户组和用户的关系：</span></span>
<span class="line"><span>		多对多，中间表ACT_ID_MEMBERSHIP</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		绑定关系：</span></span>
<span class="line"><span>			// 绑定关系</span></span>
<span class="line"><span>			identityService.createMembership(user.getId(), group.getId());</span></span>
<span class="line"><span>		接触绑定：</span></span>
<span class="line"><span>			// 删除绑定关系</span></span>
<span class="line"><span>			identityService.deleteMembership(user.getId(), group.getId());</span></span>
<span class="line"><span>		查询用户组下的用户：</span></span>
<span class="line"><span>			使用用户的查询对象  memberOfGroup(group.getId())</span></span>
<span class="line"><span>				List&lt;User&gt; users = identityService.createUserQuery()</span></span>
<span class="line"><span>				.memberOfGroup(group.getId()).list();</span></span>
<span class="line"><span>		查询用户所属的用户组：</span></span>
<span class="line"><span>			使用用户组的查询对象 groupMenber(user.getId())</span></span>
<span class="line"><span>				List&lt;Group&gt; groups = identityService.createGroupQuery()</span></span>
<span class="line"><span>						.groupMember(user.getId()).list();</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>第七章 流程存储</span></span>
<span class="line"><span>	RepositoryService 主要对Activiti中的流程存储的相关数据进行操作，这些操作包括对流程存储数据的管理、</span></span>
<span class="line"><span>		流程部署以及对流程的基本操作等。</span></span>
<span class="line"><span>	1.流程文件部署：</span></span>
<span class="line"><span>		RepositoryService负责对流程文件的部署以及流程定义的管理</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		1.Deployment对象：</span></span>
<span class="line"><span>			只提供getter方法</span></span>
<span class="line"><span>		2.DeploymentBuilder对象：</span></span>
<span class="line"><span>			DeploymentBuilder builder = repositoryService.createDeployment();</span></span>
<span class="line"><span>		3.添加输入流资源：</span></span>
<span class="line"><span>			builder.addInputStream(&quot;inputa&quot;,a)</span></span>
<span class="line"><span>				// 第一个资源输入流</span></span>
<span class="line"><span>				InputStream is1 = new FileInputStream(new File(</span></span>
<span class="line"><span>						&quot;resource/artifact/flow_inputstream1.png&quot;));</span></span>
<span class="line"><span>				// 第二个资源输入流</span></span>
<span class="line"><span>				InputStream is2 = new FileInputStream(new File(</span></span>
<span class="line"><span>						&quot;resource/artifact/flow_inputstream1.png&quot;));</span></span>
<span class="line"><span>				// 创建DeploymentBuilder实例</span></span>
<span class="line"><span>				DeploymentBuilder builder = repositoryService.createDeployment();</span></span>
<span class="line"><span>				// 为DeploymentBuilder添加资源输入流</span></span>
<span class="line"><span>				builder.addInputStream(&quot;inputA&quot;, is1);</span></span>
<span class="line"><span>				builder.addInputStream(&quot;inputB&quot;, is2);</span></span>
<span class="line"><span>				// 执行部署方法</span></span>
<span class="line"><span>				builder.deploy();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		4.添加classpath资源：</span></span>
<span class="line"><span>			builder.addClasspathResource(&quot;artifact/classpath.png&quot;)</span></span>
<span class="line"><span>				//添加classpath下的资源</span></span>
<span class="line"><span>				builder.addClasspathResource(&quot;artifact/classpath.png&quot;);</span></span>
<span class="line"><span>				//执行部署（写入到数据库中）</span></span>
<span class="line"><span>				builder.deploy();</span></span>
<span class="line"><span>		5.添加字符串资源：</span></span>
<span class="line"><span>			//添加String资源</span></span>
<span class="line"><span>			builder.addString(&quot;test&quot;, &quot;this is string method&quot;);</span></span>
<span class="line"><span>			//执行部署（写入到数据库中）</span></span>
<span class="line"><span>			builder.deploy();</span></span>
<span class="line"><span>		6.添加压缩包资源：</span></span>
<span class="line"><span>			//获取zip文件的输入流</span></span>
<span class="line"><span>			FileInputStream fis = new FileInputStream(new File(&quot;resource/artifact/ZipInputStream.zip&quot;));</span></span>
<span class="line"><span>			//读取zip文件，创建ZipInputStream对象</span></span>
<span class="line"><span>			ZipInputStream zi = new ZipInputStream(fis);</span></span>
<span class="line"><span>			//添加Zip压缩包资源</span></span>
<span class="line"><span>			builder.addZipInputStream(zi);</span></span>
<span class="line"><span>			//执行部署（写入到数据库中）</span></span>
<span class="line"><span>			builder.deploy();</span></span>
<span class="line"><span>		7.添加BPMN模型资源：</span></span>
<span class="line"><span>			addBpmnModel </span></span>
<span class="line"><span>			addBytes</span></span>
<span class="line"><span>		8.修改部署信息：</span></span>
<span class="line"><span>			//设置各个属性</span></span>
<span class="line"><span>			builder.name(&quot;crazyit&quot;).tenantId(&quot;tenanId&quot;).key(&quot;myKey&quot;).category(&quot;myCategory&quot;);</span></span>
<span class="line"><span>		9.过滤重复部署：</span></span>
<span class="line"><span>			重复部署不再写入数据库，若不同，添加方法后，仍会修改数据库</span></span>
<span class="line"><span>			builderB.enableDuplicateFiltering();</span></span>
<span class="line"><span>		10.取消部署时的验证：</span></span>
<span class="line"><span>			默认情况下，在部署时会对流程的XML文件进行验证，包括验证是否符合BPMN规范、定义的流程是否可执行。</span></span>
<span class="line"><span>				builderB.addClasspathResource(&quot;bpmn/bpmnError.bpmn&quot;)</span></span>
<span class="line"><span>				.disableBpmnValidation().deploy();</span></span>
<span class="line"><span>	2.流程定义的管理：</span></span>
<span class="line"><span>		中止流程定义、激活流程定义和设置流程权限</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		1.ProcessDefinition对象：</span></span>
<span class="line"><span>			有很多getter方法</span></span>
<span class="line"><span>		2.流程部署：</span></span>
<span class="line"><span>			将流程的描述文件写入数据库</span></span>
<span class="line"><span>		3.流程图部署：</span></span>
<span class="line"><span>		4.流程图自动生成：</span></span>
<span class="line"><span>			不自动生成 ，在配置文件中加&lt;property name=&quot;createDiagramOnDeploy&quot; value=&quot;false&quot; /&gt;</span></span>
<span class="line"><span>		5.中止与激活流程定义：</span></span>
<span class="line"><span>		6.流程定义缓存配置：</span></span>
<span class="line"><span>		7.自定义缓存</span></span>
<span class="line"><span>			自定义Java类，维护map</span></span>
<span class="line"><span>	3.流程定义的权限：</span></span>
<span class="line"><span>		activiti没有拦截检查，完全由开发者定义用户权限，然后根据表来查询</span></span>
<span class="line"><span>		1.设置流程定义的用户权限：</span></span>
<span class="line"><span>			repositoryService.addCandidateStarterUser(def.getId(), &quot;user1&quot;);</span></span>
<span class="line"><span>		2.设置流程定义的用户权限：</span></span>
<span class="line"><span>			repositoryService.addCandidateStarterGroup(def.getId(), &quot;group1&quot;);</span></span>
<span class="line"><span>		3.IdentityLink对象：</span></span>
<span class="line"><span>			对应表 ACT_RU_IDENTITYLINK</span></span>
<span class="line"><span>		4.查询权限数据：</span></span>
<span class="line"><span>			// 根据用户查询用权限的流程定义</span></span>
<span class="line"><span>			List&lt;ProcessDefinition&gt; defs = repositoryService</span></span>
<span class="line"><span>					.createProcessDefinitionQuery().startableByUser(&quot;user1&quot;).list();</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			// 根据流程定义查询用户组数据</span></span>
<span class="line"><span>			List&lt;Group&gt; groups = identityService.createGroupQuery()</span></span>
<span class="line"><span>					.potentialStarter(def.getId()).list();</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// 根据流程定义查询用户数据</span></span>
<span class="line"><span>			List&lt;User&gt; users = identityService.createUserQuery()</span></span>
<span class="line"><span>					.potentialStarter(def.getId()).list();</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// 根据流程定义查询全部的 IdentityLink（ACT_RU_IDENTITYLINK表） 数据</span></span>
<span class="line"><span>			List&lt;IdentityLink&gt; links = repositoryService</span></span>
<span class="line"><span>					.getIdentityLinksForProcessDefinition(def.getId());	</span></span>
<span class="line"><span>	4.RepositoryService数据查询与删除：</span></span>
<span class="line"><span>		1.查询部署资源</span></span>
<span class="line"><span>			// 查询资源文件</span></span>
<span class="line"><span>			InputStream is = repositoryService.getResourceAsStream(dep.getId(), </span></span>
<span class="line"><span>				&quot;artifact/GetResource.txt&quot;);</span></span>
<span class="line"><span>			// 读取输入流</span></span>
<span class="line"><span>			int count = is.available();</span></span>
<span class="line"><span>			byte[] contents = new byte[count];</span></span>
<span class="line"><span>			is.read(contents);</span></span>
<span class="line"><span>			String result = new String(contents);</span></span>
<span class="line"><span>		2.查询流程文件</span></span>
<span class="line"><span>		3.查询流程图</span></span>
<span class="line"><span>		4.查询部署的资源名称</span></span>
<span class="line"><span>		5.删除部署资源</span></span>
<span class="line"><span>		6.DeploymentQuery对象</span></span>
<span class="line"><span>		7.ProcessDefinitionQuery对象</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第八章 流程任务管理</span></span>
<span class="line"><span>	1.任务的创建和删除：</span></span>
<span class="line"><span>		1.Task接口：</span></span>
<span class="line"><span>			ACT_RU_TASK</span></span>
<span class="line"><span>		2.创建与保存Task实例：</span></span>
<span class="line"><span>			newTask</span></span>
<span class="line"><span>			saveTask</span></span>
<span class="line"><span>		3.删除任务：</span></span>
<span class="line"><span>			多个删除方法</span></span>
<span class="line"><span>	2.任务权限：</span></span>
<span class="line"><span>		1.设置候选用户组</span></span>
<span class="line"><span>		2.设置候选用户</span></span>
<span class="line"><span>		3.权限数据查询</span></span>
<span class="line"><span>			用户组和用户的Query对象没有提供根据任务ID查询用户组和用户的方法</span></span>
<span class="line"><span>		4.设置任务持有人：</span></span>
<span class="line"><span>			setOwner</span></span>
<span class="line"><span>		5.设置任务代理人</span></span>
<span class="line"><span>			setAssignee</span></span>
<span class="line"><span>		6.添加任务权限数据</span></span>
<span class="line"><span>		7.删除用户组权限</span></span>
<span class="line"><span>		8.删除用户权限</span></span>
<span class="line"><span>	3.任务参数：</span></span>
<span class="line"><span>		参数类型分为流程参数和任务参数</span></span>
<span class="line"><span>		1.基本类型参数设置：</span></span>
<span class="line"><span>			setVariable</span></span>
<span class="line"><span>		2.序列化参数：</span></span>
<span class="line"><span>			对象必须实现序列化接口</span></span>
<span class="line"><span>		3.获取参数</span></span>
<span class="line"><span>			getVariable(taskId,argName)</span></span>
<span class="line"><span>		4.参数作用域：</span></span>
<span class="line"><span>			setVariableLocal 局部参数</span></span>
<span class="line"><span>			getVariableLocal </span></span>
<span class="line"><span>		5.设置多个参数：</span></span>
<span class="line"><span>			setVariables</span></span>
<span class="line"><span>			setVariablesLocal	</span></span>
<span class="line"><span>				//初始化参数</span></span>
<span class="line"><span>				Map&lt;String,Object&gt; vars = new HashMap&lt;String, Object&gt;();</span></span>
<span class="line"><span>				vars.put(&quot;days&quot;, 10);</span></span>
<span class="line"><span>				vars.put(&quot;target&quot;, &quot;欧洲&quot;);</span></span>
<span class="line"><span>				taskService.setVariables(task1.getId(), vars);</span></span>
<span class="line"><span>			或使用序列化对象</span></span>
<span class="line"><span>		6.数据对象：</span></span>
<span class="line"><span>			BPMN文件中的dataObject元素</span></span>
<span class="line"><span>				Map&lt;String, DataObject&gt; objs = taskService.getDataObjects(task.getId());</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	4.任务附件管理：</span></span>
<span class="line"><span>		1.Attachment对象：</span></span>
<span class="line"><span>		2.创建任务附件：</span></span>
<span class="line"><span>			// 设置任务附件</span></span>
<span class="line"><span>			taskService.createAttachment(&quot;web url&quot;, task.getId(), pi.getId(), &quot;163.com&quot;, </span></span>
<span class="line"><span>					&quot;163 web page&quot;, &quot;http://www.163.com&quot;);</span></span>
<span class="line"><span>			// 创建图片输入流</span></span>
<span class="line"><span>			InputStream is = new FileInputStream(new File(&quot;resource/artifact/result.png&quot;));</span></span>
<span class="line"><span>			// 设置输入流为任务附件</span></span>
<span class="line"><span>			taskService.createAttachment(&quot;web url&quot;, task.getId(), pi.getId(), &quot;163.com&quot;, </span></span>
<span class="line"><span>					&quot;163 web page&quot;, is);</span></span>
<span class="line"><span>		3.附件查询：</span></span>
<span class="line"><span>		4.删除附件</span></span>
<span class="line"><span>	5.任务评论和事件记录：</span></span>
<span class="line"><span>		1.Comment对象:</span></span>
<span class="line"><span>		2.新增任务评论</span></span>
<span class="line"><span>			addComment</span></span>
<span class="line"><span>		3.事件的记录</span></span>
<span class="line"><span>		4.数据查询</span></span>
<span class="line"><span>	6.任务声明与完成：</span></span>
<span class="line"><span>		1.任务声明：</span></span>
<span class="line"><span>			claim</span></span>
<span class="line"><span>		2.任务完成：</span></span>
<span class="line"><span>			complete</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第九章 流程控制</span></span>
<span class="line"><span>	TaskService主要用于任务管理，包括任务操作、任务数据管理等</span></span>
<span class="line"><span>	IdentityService主要用于管理流程的身份数据</span></span>
<span class="line"><span>	RepositoryService主要管理流程部署的数据</span></span>
<span class="line"><span>	RuntimeService主要用于管理流程在运行时产生的数据，以及对流程进行操作的API</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	流程运行时产生的数据包括流程参数、事件、流程 实例及执行流等</span></span>
<span class="line"><span>	流程的操作包括启动流程，流程前进等</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	1.流程实例与执行流：</span></span>
<span class="line"><span>		1.流程实例与执行流的概念：</span></span>
<span class="line"><span>			启动一个流程时，会创建一个流程实例，每个流程实例至少有一个执行流</span></span>
<span class="line"><span>		2.流程实例和执行流对象 ProcessInstance Execution</span></span>
<span class="line"><span>	2.启动流程:</span></span>
<span class="line"><span>		RuntimeService提供流程启动的多个方法，命名均为startProcessInstanceByXXX</span></span>
<span class="line"><span>			XXX可以是流程定义的ID、Key【流程描述文件中process的id属性】和message</span></span>
<span class="line"><span>		1.startProcessInstanceById方法：</span></span>
<span class="line"><span>		2.startProcessInstanceByKey方法</span></span>
<span class="line"><span>		3.startProcessInstanceByMessage方法</span></span>
<span class="line"><span>			消息事件</span></span>
<span class="line"><span>	3.流程参数：</span></span>
<span class="line"><span>		1.设置与查询流程参数：</span></span>
<span class="line"><span>			设置需要传入执行流的ID</span></span>
<span class="line"><span>			查询需要传入执行流的ID和参数名称</span></span>
<span class="line"><span>			setViriable</span></span>
<span class="line"><span>		2.流程参数的作用域：</span></span>
<span class="line"><span>			局部只作用域执行流</span></span>
<span class="line"><span>			setViriableLocal</span></span>
<span class="line"><span>		3.其他设置参数的方法：</span></span>
<span class="line"><span>			setViriables</span></span>
<span class="line"><span>			setViriablesLocal</span></span>
<span class="line"><span>	4.流程操作：</span></span>
<span class="line"><span>		启动流程、发送信号、中断流程、激活流程</span></span>
<span class="line"><span>		1.流程触发：</span></span>
<span class="line"><span>			对于receiveTask等流程节点，使用trigger方法进行触发，使流程往前进行</span></span>
<span class="line"><span>		2.触发信号事件：</span></span>
<span class="line"><span>			事件节点是在流程中记录事件发生的流程元素，BPMN2 规范中主要有两种类型的事件：</span></span>
<span class="line"><span>				捕获事件Catching 需要信号才能前进 </span></span>
<span class="line"><span>					// 发送信号给事件，流程结束</span></span>
<span class="line"><span>					runtimeService.signalEventReceived(&quot;testSignal&quot;);</span></span>
<span class="line"><span>				抛出事件Throwing</span></span>
<span class="line"><span>		3.触发消息事件：</span></span>
<span class="line"><span>			消息事件节点</span></span>
<span class="line"><span>				// 触发消息事件</span></span>
<span class="line"><span>				runtimeService.messageEventReceived(&quot;testMsg&quot;, exe.getId());</span></span>
<span class="line"><span>		4.中断和激活流程：</span></span>
<span class="line"><span>			SUSPENSION_STATE_字段保存中断状态，1为活跃，2为中断</span></span>
<span class="line"><span>				runtimeService.suspendProcessInstanceById(pi.getId());</span></span>
<span class="line"><span>				runtimeService.activateProcessInstanceById(pi.getId());</span></span>
<span class="line"><span>		5.删除流程：</span></span>
<span class="line"><span>			runtimeService.deleteProcessInstance(pi.getId(), &quot;abc&quot;);</span></span>
<span class="line"><span>	5.流程数据查询：</span></span>
<span class="line"><span>		1.执行流查询：</span></span>
<span class="line"><span>		2.流程实例查询</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>第十章 历史数据管理和流程引擎管理</span></span>
<span class="line"><span>	历史数据：</span></span>
<span class="line"><span>		activiti删除的流程定义、流程任务和流程实例的数据</span></span>
<span class="line"><span>		已经完成的流程实例以及相关数据</span></span>
<span class="line"><span>	ManagementService可以查询引擎数据库信息、工作信息，直接对数据库操作</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	1.历史数据管理：</span></span>
<span class="line"><span>		1.历史流程实例查询：</span></span>
<span class="line"><span>			historyService.createHistoricProcessInstanceQuery()</span></span>
<span class="line"><span>		2.历史任务查询：</span></span>
<span class="line"><span>			historyService.createHistoricTaskInstanceQuery()</span></span>
<span class="line"><span>		3.历史行为查询：</span></span>
<span class="line"><span>			historyService.createHistoricActivityInstanceQuery()</span></span>
<span class="line"><span>		4.历史流程明细查询：</span></span>
<span class="line"><span>			流程的明细信息包括流程参数和流程表单属性</span></span>
<span class="line"><span>				默认情况下，Activiti不会记录明细，当history配置为full级别时，才会记录</span></span>
<span class="line"><span>		5.删除历史流程实例和历史任务：</span></span>
<span class="line"><span>			historyService.deleteHistoricProcessInstance(pi1.getId());</span></span>
<span class="line"><span>			级联删除实例</span></span>
<span class="line"><span>	2.工作的产生：</span></span>
<span class="line"><span>		异步工作时，用工作表保存任务</span></span>
<span class="line"><span>			一般的工作 ACT_RU_JOB</span></span>
<span class="line"><span>			定时中断任务 ACT_RU_SUSPENDED_JOB</span></span>
<span class="line"><span>			定时任务 ACT_RU_TIMER_JOB</span></span>
<span class="line"><span>		1.异步任务产生的工作：</span></span>
<span class="line"><span>			Java Service Task主要用于在任务中调用外部的Java 类</span></span>
<span class="line"><span>		2.定义中间事件产生的工作：</span></span>
<span class="line"><span>			定义了定时器相关的节点，会在某个定义的时间点上执行。</span></span>
<span class="line"><span>			可以加入定时器的节点：</span></span>
<span class="line"><span>				中间事件节点、流程开始事件节点和边界事件节点</span></span>
<span class="line"><span>		3.定义边界事件产生的工作：</span></span>
<span class="line"><span>		4.定时开始事件产生的工作</span></span>
<span class="line"><span>		5.流程抛出事件产生的工作</span></span>
<span class="line"><span>		6.暂停工作的产生</span></span>
<span class="line"><span>		7.无法执行的工作</span></span>
<span class="line"><span>	3.工作管理：</span></span>
<span class="line"><span>		ManagementService提供工作查询对象（对象返回job实例）</span></span>
<span class="line"><span>		1.工作查询对象：	</span></span>
<span class="line"><span>			4个：</span></span>
<span class="line"><span>				JobQuery</span></span>
<span class="line"><span>				TimerJobQuery</span></span>
<span class="line"><span>				SuspendedJobQuery</span></span>
<span class="line"><span>				DeadLetterJobQuery</span></span>
<span class="line"><span>		2.获取工作异常信息：</span></span>
<span class="line"><span>			getXXXJobExceptionStacktrace</span></span>
<span class="line"><span>		3.转移与删除工作：</span></span>
<span class="line"><span>			move</span></span>
<span class="line"><span>			delete</span></span>
<span class="line"><span>	4.数据库管理：</span></span>
<span class="line"><span>		1.查询引擎属性</span></span>
<span class="line"><span>		2.数据表信息查询</span></span>
<span class="line"><span>		3.数据库操作</span></span>
<span class="line"><span>		4.数据表查询</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>第十一章 流程事件</span></span>
<span class="line"><span>	要点：</span></span>
<span class="line"><span>		BPMN的事件分类</span></span>
<span class="line"><span>		各种流程的事件定义</span></span>
<span class="line"><span>		开始事件的应用</span></span>
<span class="line"><span>		结束事件的应用</span></span>
<span class="line"><span>		边界事件的应用</span></span>
<span class="line"><span>		中间事件的应用</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	1.事件分类：</span></span>
<span class="line"><span>		1.按照事件的位置分类：</span></span>
<span class="line"><span>			开始事件：表示流程开始的事件</span></span>
<span class="line"><span>			结束事件：表示流程结束的事件</span></span>
<span class="line"><span>			中间事件：出现在流程中，单独作为流程节点的事件</span></span>
<span class="line"><span>			边界事件：附属于某个流程节点（如子流程，流程任务）的事件</span></span>
<span class="line"><span>		2.按照事件的特性分类：</span></span>
<span class="line"><span>			Catching事件</span></span>
<span class="line"><span>			Throwing事件</span></span>
<span class="line"><span>				开始事件是Catching</span></span>
<span class="line"><span>				结束事件是throwing</span></span>
<span class="line"><span>				边界时catching</span></span>
<span class="line"><span>				中间 都有</span></span>
<span class="line"><span>	2.事件定义：</span></span>
<span class="line"><span>		与事件结合</span></span>
<span class="line"><span>	3.开始事件：</span></span>
<span class="line"><span>		无指定开始事件</span></span>
<span class="line"><span>		定时器开始事件</span></span>
<span class="line"><span>		消息开始事件</span></span>
<span class="line"><span>		错误开始事件</span></span>
<span class="line"><span>	4.结束事件：</span></span>
<span class="line"><span>		无指定结束事件</span></span>
<span class="line"><span>		错误结束事件</span></span>
<span class="line"><span>		取消结束事件</span></span>
<span class="line"><span>		中止结束事件</span></span>
<span class="line"><span>	5.边界事件</span></span>
<span class="line"><span>		定时器</span></span>
<span class="line"><span>		信号</span></span>
<span class="line"><span>		错误</span></span>
<span class="line"><span>		取消</span></span>
<span class="line"><span>	6.中间事件</span></span>
<span class="line"><span>		定时器  捕获</span></span>
<span class="line"><span>		信号 捕获 抛出</span></span>
<span class="line"><span>		消息 抛出	</span></span>
<span class="line"><span>	7.补偿事件</span></span>
<span class="line"><span>		补偿边界</span></span>
<span class="line"><span>			事务子流程取消触发</span></span>
<span class="line"><span>			补偿中间触发</span></span>
<span class="line"><span>		补偿中间</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第十二章 流程任务</span></span>
<span class="line"><span>	BPMN任务概述</span></span>
<span class="line"><span>	用户任务的应用</span></span>
<span class="line"><span>	指定服务任务的行为</span></span>
<span class="line"><span>	WebService任务的应用</span></span>
<span class="line"><span>	脚本任务的应用</span></span>
<span class="line"><span>	任务监听器的使用</span></span>
<span class="line"><span>	流程监听器的使用</span></span>
<span class="line"><span></span></span>
<span class="line"><span>	1.用户任务：</span></span>
<span class="line"><span>		1.分配任务候选人</span></span>
<span class="line"><span>			&lt;userTask id=&quot;usertask1&quot; name=&quot;Task1&quot;&gt;</span></span>
<span class="line"><span>				&lt;potentialOwner&gt;</span></span>
<span class="line"><span>					&lt;resourceAssignmentExpression&gt;</span></span>
<span class="line"><span>						&lt;formalExpression&gt;user(angus), group(management), boss</span></span>
<span class="line"><span>						&lt;/formalExpression&gt;</span></span>
<span class="line"><span>					&lt;/resourceAssignmentExpression&gt;</span></span>
<span class="line"><span>				&lt;/potentialOwner&gt;</span></span>
<span class="line"><span>			&lt;/userTask&gt;</span></span>
<span class="line"><span>		2.分配任务代理人</span></span>
<span class="line"><span>			&lt;userTask id=&quot;usertask1&quot; name=&quot;Task 1&quot;&gt;</span></span>
<span class="line"><span>				&lt;humanPerformer&gt;</span></span>
<span class="line"><span>					&lt;resourceAssignmentExpression&gt;</span></span>
<span class="line"><span>						&lt;formalExpression&gt;user1&lt;/formalExpression&gt;</span></span>
<span class="line"><span>					&lt;/resourceAssignmentExpression&gt;</span></span>
<span class="line"><span>				&lt;/humanPerformer&gt;</span></span>
<span class="line"><span>			&lt;/userTask&gt;</span></span>
<span class="line"><span>		3.权限分配扩展</span></span>
<span class="line"><span>			使用activiti扩展来分配任务的候选人和代理人</span></span>
<span class="line"><span>				&lt;userTask id=&quot;usertask1&quot; name=&quot;Assignee&quot; activiti:assignee=&quot;user1&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>				&lt;userTask id=&quot;usertask2&quot; name=&quot;Candidate User&quot;</span></span>
<span class="line"><span>					activiti:candidateUsers=&quot;user1, user2&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>				&lt;userTask id=&quot;usertask3&quot; name=&quot;Candidate Group&quot;</span></span>
<span class="line"><span>					activiti:candidateGroups=&quot;group1,group2&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>		4.使用任务监听器进行权限分配</span></span>
<span class="line"><span>			设置监听类</span></span>
<span class="line"><span>				public class UserTaskListener implements TaskListener {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>					public void notify(DelegateTask delegateTask) {</span></span>
<span class="line"><span>						System.out.println(&quot;使用任务监听器设置任务权限&quot;);</span></span>
<span class="line"><span>						delegateTask.setAssignee(&quot;user1&quot;);</span></span>
<span class="line"><span>						delegateTask.addCandidateGroup(&quot;group1&quot;);</span></span>
<span class="line"><span>						delegateTask.addCandidateUser(&quot;user1&quot;);		</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			配置监听器</span></span>
<span class="line"><span>				&lt;userTask id=&quot;usertask1&quot; name=&quot;Assignee&quot;&gt;</span></span>
<span class="line"><span>					&lt;extensionElements&gt;</span></span>
<span class="line"><span>						&lt;activiti:taskListener event=&quot;create&quot;</span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.UserTaskListener&quot;&gt;&lt;/activiti:taskListener&gt;</span></span>
<span class="line"><span>					&lt;/extensionElements&gt;</span></span>
<span class="line"><span>				&lt;/userTask&gt;</span></span>
<span class="line"><span>		5.使用JUEL分配权限</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			&lt;userTask id=&quot;usertask2&quot; name=&quot;Task 1&quot; activiti:assignee=&quot;${authService.getUserAssignee()}&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>			&lt;userTask id=&quot;usertask3&quot; name=&quot;Task 2&quot; activiti:candidateUsers=&quot;${authService.getCandidateUsers()}&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>			&lt;userTask id=&quot;usertask4&quot; name=&quot;Task 3&quot; activiti:candidateGroups=&quot;${authService.getCandidateGroups()}&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>			&lt;userTask id=&quot;usertask5&quot; name=&quot;Task 4&quot; activiti:assignee=&quot;${authService.lastUser}&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>			服务Bean</span></span>
<span class="line"><span>			public class AuthService implements Serializable {</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>				private String lastUser = &quot;angus&quot;;</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>				public String getLastUser() {</span></span>
<span class="line"><span>					return this.lastUser;</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>				public AuthService() {</span></span>
<span class="line"><span>					System.out.println(&quot;create AuthService&quot;);</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>				//使用方法为任务指定代理人</span></span>
<span class="line"><span>				public String getUserAssignee() {</span></span>
<span class="line"><span>					return &quot;crazyit&quot;;</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>				//使用方法为任务指定候选人</span></span>
<span class="line"><span>				public List&lt;String&gt; getCandidateUsers() {</span></span>
<span class="line"><span>					List&lt;String&gt; result = new ArrayList&lt;String&gt;();</span></span>
<span class="line"><span>					result.add(&quot;user1&quot;);</span></span>
<span class="line"><span>					result.add(&quot;user2&quot;);</span></span>
<span class="line"><span>					return result;</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>				//使用方法为任务指定候选用户组</span></span>
<span class="line"><span>				public List&lt;String&gt; getCandidateGroups() {</span></span>
<span class="line"><span>					List&lt;String&gt; result = new ArrayList&lt;String&gt;();</span></span>
<span class="line"><span>					result.add(&quot;group1&quot;);</span></span>
<span class="line"><span>					result.add(&quot;group2&quot;);</span></span>
<span class="line"><span>					return result;</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			添加流程变量</span></span>
<span class="line"><span>			Map&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();</span></span>
<span class="line"><span>			vars.put(&quot;authService&quot;, new AuthService());</span></span>
<span class="line"><span>			// 启动流程</span></span>
<span class="line"><span>			ProcessInstance pi = runtimeService.startProcessInstanceByKey(&quot;process1&quot;, vars);</span></span>
<span class="line"><span>					</span></span>
<span class="line"><span>	2.服务任务：</span></span>
<span class="line"><span>		activiti:class: JavaDelegate或ActivitiBehavior的实现类</span></span>
<span class="line"><span>		activiti:delegateExpression  </span></span>
<span class="line"><span>		activiti:expression 直接调用bean</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		1.实现JavaDelegate</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			public class MyJavaDelegate implements JavaDelegate, Serializable {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>				public void execute(DelegateExecution execution) {</span></span>
<span class="line"><span>					System.out.println(&quot; 实现  JavaDelegate 的  JavaSeviceTask: &quot; + this);</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>			activiti:class方式：</span></span>
<span class="line"><span></span></span>
<span class="line"><span>				&lt;serviceTask id=&quot;servicetask1&quot; name=&quot;Service Task 1&quot;</span></span>
<span class="line"><span>					activiti:class=&quot;org.crazyit.activiti.MyJavaDelegate&quot;&gt;&lt;/serviceTask&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			activiti:delegateExpression 方式：</span></span>
<span class="line"><span>				Map&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();</span></span>
<span class="line"><span>				vars.put(&quot;myDelegate&quot;, new MyJavaDelegate());</span></span>
<span class="line"><span>				// 启动流程</span></span>
<span class="line"><span>				ProcessInstance pi = runtimeService.startProcessInstanceByKey(&quot;process1&quot;, vars);</span></span>
<span class="line"><span></span></span>
<span class="line"><span>				&lt;serviceTask id=&quot;servicetask1&quot; name=&quot;Service Task&quot;</span></span>
<span class="line"><span>					activiti:delegateExpression=&quot;${myDelegate}&quot;&gt;&lt;/serviceTask&gt;</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>		2.使用普通的JavaBean</span></span>
<span class="line"><span>			调用Bean方法和属性</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			Bean类：</span></span>
<span class="line"><span>				public class MyJavaBean implements Serializable {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>					private String name = &quot;crazyit&quot;;</span></span>
<span class="line"><span>					</span></span>
<span class="line"><span>					public String getName() {</span></span>
<span class="line"><span>						return this.name;</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>					</span></span>
<span class="line"><span>					public void print(Execution exe) {</span></span>
<span class="line"><span>						System.out.println(&quot;使用Java Bean的print方法：&quot; + exe.getId());</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			BPMN：</span></span>
<span class="line"><span>				&lt;serviceTask id=&quot;servicetask1&quot; name=&quot;Service Task&quot;</span></span>
<span class="line"><span>					activiti:expression=&quot;${myBean.print(execution)}&quot;&gt;&lt;/serviceTask&gt;</span></span>
<span class="line"><span>				&lt;serviceTask id=&quot;servicetask2&quot; name=&quot;Service Task&quot;</span></span>
<span class="line"><span>					activiti:expression=&quot;${execution.setVariable(&#39;myName&#39;, myBean.name)}&quot;&gt;&lt;/serviceTask&gt;</span></span>
<span class="line"><span>			设置参数：</span></span>
<span class="line"><span>				Map&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();</span></span>
<span class="line"><span>				vars.put(&quot;myBean&quot;, new MyJavaBean());</span></span>
<span class="line"><span>				// 启动流程</span></span>
<span class="line"><span>				ProcessInstance pi = runtimeService.startProcessInstanceByKey(</span></span>
<span class="line"><span>						&quot;process1&quot;, vars);</span></span>
<span class="line"><span>		3.Shell任务：</span></span>
<span class="line"><span>			执行cmd命令</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	3.流程与任务监听器：</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		任务监听器taskListener  设置event  =&quot;create/complete/assignment&quot;表示用户任务创建时调用监听器</span></span>
<span class="line"><span>			&lt;userTask id=&quot;usertask1&quot; name=&quot;User Task&quot;&gt;</span></span>
<span class="line"><span>				&lt;extensionElements&gt;</span></span>
<span class="line"><span>					&lt;activiti:taskListener event=&quot;create&quot;</span></span>
<span class="line"><span>						class=&quot;org.crazyit.activiti.PropertyConfigListener&quot; /&gt;</span></span>
<span class="line"><span>				&lt;/extensionElements&gt;</span></span>
<span class="line"><span>			&lt;/userTask&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			属性注入，往任务监听器中注入属性</span></span>
<span class="line"><span>				&lt;userTask id=&quot;usertask1&quot; name=&quot;User Task&quot;&gt;</span></span>
<span class="line"><span>					&lt;extensionElements&gt;</span></span>
<span class="line"><span>						&lt;activiti:taskListener event=&quot;create&quot;</span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.PropertyInjection&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:field name=&quot;userName&quot; stringValue=&quot;crazyit&quot; /&gt;</span></span>
<span class="line"><span>						&lt;/activiti:taskListener&gt;</span></span>
<span class="line"><span>					&lt;/extensionElements&gt;</span></span>
<span class="line"><span>				&lt;/userTask&gt;</span></span>
<span class="line"><span>				监听器类：</span></span>
<span class="line"><span>					public class PropertyInjection implements TaskListener {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>						private Expression userName;</span></span>
<span class="line"><span>						</span></span>
<span class="line"><span>						public void setUserName(Expression userName) {</span></span>
<span class="line"><span>							this.userName = userName;</span></span>
<span class="line"><span>						}</span></span>
<span class="line"><span>						</span></span>
<span class="line"><span>						public void notify(DelegateTask delegateTask) {</span></span>
<span class="line"><span>							System.out.println(&quot;属性注入后的值：&quot; + this.userName.getValue(null));</span></span>
<span class="line"><span>						}</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		流程监听器：</span></span>
<span class="line"><span>			&lt;activiti:executionListener event=&quot;XXXXX&quot;</span></span>
<span class="line"><span>				class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>				&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>					&lt;activiti:string&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>				&lt;/activiti:field&gt;</span></span>
<span class="line"><span>			&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span></span></span>
<span class="line"><span></span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			&lt;process id=&quot;process1&quot; name=&quot;process1&quot; isExecutable=&quot;true&quot;&gt;</span></span>
<span class="line"><span>				&lt;extensionElements&gt;</span></span>
<span class="line"><span>					&lt;activiti:executionListener event=&quot;end&quot;</span></span>
<span class="line"><span>						class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>						&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:string&gt;&lt;![CDATA[流程结束]]&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>						&lt;/activiti:field&gt;</span></span>
<span class="line"><span>					&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>					&lt;activiti:executionListener event=&quot;start&quot;</span></span>
<span class="line"><span>						class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>						&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:string&gt;&lt;![CDATA[流程开始]]&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>						&lt;/activiti:field&gt;</span></span>
<span class="line"><span>					&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>				&lt;/extensionElements&gt;</span></span>
<span class="line"><span>				&lt;startEvent id=&quot;startevent1&quot; name=&quot;Start&quot;&gt;&lt;/startEvent&gt;</span></span>
<span class="line"><span>				&lt;userTask id=&quot;usertask1&quot; name=&quot;Task 1&quot;&gt;</span></span>
<span class="line"><span>					&lt;extensionElements&gt;</span></span>
<span class="line"><span>						&lt;activiti:executionListener event=&quot;end&quot;</span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>								&lt;activiti:string&gt;&lt;![CDATA[用户任务结束]]&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>							&lt;/activiti:field&gt;</span></span>
<span class="line"><span>						&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>						&lt;activiti:executionListener event=&quot;start&quot;</span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>								&lt;activiti:string&gt;&lt;![CDATA[用户任务开始]]&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>							&lt;/activiti:field&gt;</span></span>
<span class="line"><span>						&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>					&lt;/extensionElements&gt;</span></span>
<span class="line"><span>				&lt;/userTask&gt;</span></span>
<span class="line"><span>				&lt;exclusiveGateway id=&quot;exclusivegateway1&quot; name=&quot;Exclusive Gateway&quot;&gt;</span></span>
<span class="line"><span>					&lt;extensionElements&gt;</span></span>
<span class="line"><span>						&lt;activiti:executionListener event=&quot;start&quot;</span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>								&lt;activiti:string&gt;&lt;![CDATA[网关开始]]&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>							&lt;/activiti:field&gt;</span></span>
<span class="line"><span>						&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>					&lt;/extensionElements&gt;</span></span>
<span class="line"><span>				&lt;/exclusiveGateway&gt;</span></span>
<span class="line"><span>				&lt;intermediateThrowEvent id=&quot;signalintermediatethrowevent1&quot;</span></span>
<span class="line"><span>					name=&quot;SignalThrowEvent&quot;&gt;</span></span>
<span class="line"><span>					&lt;extensionElements&gt;</span></span>
<span class="line"><span>						&lt;activiti:executionListener event=&quot;end&quot;</span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>								&lt;activiti:string&gt;&lt;![CDATA[中间事件结束]]&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>							&lt;/activiti:field&gt;</span></span>
<span class="line"><span>						&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>						&lt;activiti:executionListener event=&quot;start&quot;</span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:field name=&quot;message&quot;&gt;</span></span>
<span class="line"><span>								&lt;activiti:string&gt;&lt;![CDATA[中间事件开始]]&gt;&lt;/activiti:string&gt;</span></span>
<span class="line"><span>							&lt;/activiti:field&gt;</span></span>
<span class="line"><span>						&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>					&lt;/extensionElements&gt;</span></span>
<span class="line"><span>				&lt;/intermediateThrowEvent&gt;</span></span>
<span class="line"><span>				&lt;endEvent id=&quot;endevent1&quot; name=&quot;End&quot;&gt;&lt;/endEvent&gt;</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow1&quot; sourceRef=&quot;startevent1&quot;</span></span>
<span class="line"><span>					targetRef=&quot;exclusivegateway1&quot;&gt;</span></span>
<span class="line"><span>					&lt;extensionElements&gt;</span></span>
<span class="line"><span>						&lt;activiti:executionListener </span></span>
<span class="line"><span>							class=&quot;org.crazyit.activiti.ExecutionListenerInvocation&quot;&gt;</span></span>
<span class="line"><span>							&lt;activiti:field name=&quot;message&quot; stringValue=&quot;从开始事件到网关的顺序流&quot;/&gt;</span></span>
<span class="line"><span>						&lt;/activiti:executionListener&gt;</span></span>
<span class="line"><span>					&lt;/extensionElements&gt;	</span></span>
<span class="line"><span>				&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow3&quot; sourceRef=&quot;usertask1&quot;</span></span>
<span class="line"><span>					targetRef=&quot;signalintermediatethrowevent1&quot;&gt;&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow4&quot; sourceRef=&quot;signalintermediatethrowevent1&quot;</span></span>
<span class="line"><span>					targetRef=&quot;endevent1&quot;&gt;&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow5&quot; sourceRef=&quot;exclusivegateway1&quot;</span></span>
<span class="line"><span>					targetRef=&quot;usertask1&quot;&gt;&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>			&lt;/process&gt;</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>第十三章 其他流程元素	</span></span>
<span class="line"><span>	1.子流程：</span></span>
<span class="line"><span>		1.嵌入式子流程</span></span>
<span class="line"><span>			&lt;subProcess id=&quot;subprocess1&quot; name=&quot;Sub Process&quot;&gt;</span></span>
<span class="line"><span>				&lt;startEvent id=&quot;startevent2&quot; name=&quot;Start&quot;&gt;&lt;/startEvent&gt;</span></span>
<span class="line"><span>				&lt;serviceTask id=&quot;usertask2&quot; name=&quot;Sub Task&quot;</span></span>
<span class="line"><span>					activiti:class=&quot;org.crazyit.activiti.EmbededJavaDelegate&quot;&gt;&lt;/serviceTask&gt;</span></span>
<span class="line"><span>				&lt;endEvent id=&quot;endevent1&quot; name=&quot;End&quot;&gt;&lt;/endEvent&gt;</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow3&quot; sourceRef=&quot;startevent2&quot;</span></span>
<span class="line"><span>					targetRef=&quot;usertask2&quot;&gt;&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow4&quot; sourceRef=&quot;usertask2&quot;</span></span>
<span class="line"><span>					targetRef=&quot;endevent1&quot;&gt;&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>			&lt;/subProcess&gt;</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		2.调用式子流程</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			&lt;callActivity id=&quot;subprocess1&quot; name=&quot;人事、总监子流程&quot; calledElement=&quot;SubProcess&quot;&gt;</span></span>
<span class="line"><span>				&lt;extensionElements&gt;</span></span>
<span class="line"><span>					&lt;activiti:in source=&quot;days&quot; target=&quot;newDays&quot;&gt;&lt;/activiti:in&gt;</span></span>
<span class="line"><span>					&lt;activiti:out source=&quot;myDays&quot; target=&quot;resultDays&quot;&gt;&lt;/activiti:out&gt;</span></span>
<span class="line"><span>				&lt;/extensionElements&gt;</span></span>
<span class="line"><span>			&lt;/callActivity&gt;</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// 部署流程文件</span></span>
<span class="line"><span>			repositoryService</span></span>
<span class="line"><span>					.createDeployment()</span></span>
<span class="line"><span>					.addClasspathResource(</span></span>
<span class="line"><span>							&quot;bpmn/CallActivityVariable.bpmn&quot;)</span></span>
<span class="line"><span>					.addClasspathResource(&quot;bpmn/SubProcess.bpmn&quot;)</span></span>
<span class="line"><span>					.deploy();		</span></span>
<span class="line"><span></span></span>
<span class="line"><span>		3.事件子流程</span></span>
<span class="line"><span>		4.事务子流程</span></span>
<span class="line"><span>		5.特别子流程</span></span>
<span class="line"><span>			bpmn不指定子流程的执行顺序,实际运行时指定运行顺序</span></span>
<span class="line"><span>			&lt;adHocSubProcess id=&quot;adhocSubProcess&quot; ordering=&quot;Sequential&quot;&gt;</span></span>
<span class="line"><span>				&lt;userTask id=&quot;subProcessTask&quot; name=&quot;Task in subprocess&quot; /&gt;</span></span>
<span class="line"><span>				&lt;userTask id=&quot;subProcessTask2&quot; name=&quot;Task2 in subprocess&quot; /&gt;</span></span>
<span class="line"><span>			&lt;/adHocSubProcess&gt;</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// 查询子流程的执行流</span></span>
<span class="line"><span>			Execution exe = runtimeService.createExecutionQuery()</span></span>
<span class="line"><span>					.processInstanceId(pi.getId()).activityId(&quot;adhocSubProcess&quot;)</span></span>
<span class="line"><span>					.singleResult();</span></span>
<span class="line"><span>			// 让执行流到达第二个任务</span></span>
<span class="line"><span>			runtimeService.executeActivityInAdhocSubProcess(exe.getId(),</span></span>
<span class="line"><span>					&quot;subProcessTask2&quot;);	</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			// 完成第二个任务</span></span>
<span class="line"><span>			Task subProcessTask2 = taskService.createTaskQuery()</span></span>
<span class="line"><span>					.processInstanceId(pi.getId())</span></span>
<span class="line"><span>					.taskDefinitionKey(&quot;subProcessTask2&quot;).singleResult();</span></span>
<span class="line"><span>			taskService.complete(subProcessTask2.getId());</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			// 完成特别子流程✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓</span></span>
<span class="line"><span>			//✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓</span></span>
<span class="line"><span>			runtimeService.completeAdhocSubProcess(exe.getId());</span></span>
<span class="line"><span>			//✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓✓</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>	2.顺序流与网关：</span></span>
<span class="line"><span>		顺序流：</span></span>
<span class="line"><span>			条件顺序流</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow4&quot; name=&quot;小于等于5天&quot; sourceRef=&quot;exclusivegateway1&quot;</span></span>
<span class="line"><span>					targetRef=&quot;usertask2&quot;&gt;</span></span>
<span class="line"><span>					&lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;</span></span>
<span class="line"><span>					&lt;![CDATA[</span></span>
<span class="line"><span>					${days &lt;= 5}</span></span>
<span class="line"><span>					]]&gt;</span></span>
<span class="line"><span>					&lt;/conditionExpression&gt;</span></span>
<span class="line"><span>				&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow5&quot; name=&quot;大于5天&quot; sourceRef=&quot;exclusivegateway1&quot;</span></span>
<span class="line"><span>					targetRef=&quot;usertask3&quot;&gt;</span></span>
<span class="line"><span>					&lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;</span></span>
<span class="line"><span>					&lt;![CDATA[</span></span>
<span class="line"><span>					${days &gt; 5}</span></span>
<span class="line"><span>					]]&gt;</span></span>
<span class="line"><span>					&lt;/conditionExpression&gt;</span></span>
<span class="line"><span>				&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>				执行示例：</span></span>
<span class="line"><span>				Map&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();</span></span>
<span class="line"><span>				vars.put(&quot;days&quot;, 6);</span></span>
<span class="line"><span>				ProcessInstance pi = runtimeService.startProcessInstanceByKey(</span></span>
<span class="line"><span>				&quot;process1&quot;, vars);</span></span>
<span class="line"><span>			默认顺序流</span></span>
<span class="line"><span>				&lt;userTask id=&quot;usertask1&quot; name=&quot;填写请假申请&quot; default=&quot;flow1&quot;&gt;&lt;/userTask&gt;</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow1&quot; sourceRef=&quot;usertask1&quot; targetRef=&quot;usertask2&quot;&gt;&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>				&lt;sequenceFlow id=&quot;flow2&quot; sourceRef=&quot;usertask1&quot; targetRef=&quot;usertask3&quot;&gt;</span></span>
<span class="line"><span>					&lt;conditionExpression xsi:type=&quot;tFormalExpression&quot;&gt;&lt;![CDATA[</span></span>
<span class="line"><span>					${days &gt; 5}</span></span>
<span class="line"><span>					]]&gt;&lt;/conditionExpression&gt;</span></span>
<span class="line"><span>				&lt;/sequenceFlow&gt;</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>		流程网关：</span></span>
<span class="line"><span>			单向网关</span></span>
<span class="line"><span>			并行网关</span></span>
<span class="line"><span>			兼容网关</span></span>
<span class="line"><span>			事件网关</span></span>
<span class="line"><span>			组合网关（Activiti不支持）</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			单向网关</span></span>
<span class="line"><span>			并行网关：</span></span>
<span class="line"><span>				分叉 合并</span></span>
<span class="line"><span>			兼容网关：</span></span>
<span class="line"><span>				单向网关和并行网关结合</span></span>
<span class="line"><span>			事件网关：</span></span>
<span class="line"><span>				哪个事件先触发，就转向哪一个执行流</span></span>
<span class="line"><span>				事件网关只会选择最先触发的事件所在的分支向前执行</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	3.流程活动的特性：</span></span>
<span class="line"><span>		1.多实例活动</span></span>
<span class="line"><span>			&lt;multiInstanceLoopCharacteristics</span></span>
<span class="line"><span>				isSequential=&quot;true&quot;&gt;</span></span>
<span class="line"><span>				&lt;loopCardinality&gt;2&lt;/loopCardinality&gt;</span></span>
<span class="line"><span>			&lt;/multiInstanceLoopCharacteristics&gt;</span></span>
<span class="line"><span>		2.设置循环数据</span></span>
<span class="line"><span>			&lt;multiInstanceLoopCharacteristics</span></span>
<span class="line"><span>				isSequential=&quot;false&quot; activiti:collection=&quot;datas1&quot;&gt;</span></span>
<span class="line"><span>			&lt;/multiInstanceLoopCharacteristics&gt;</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			List&lt;String&gt; datas1 = new ArrayList&lt;String&gt;();</span></span>
<span class="line"><span>			datas1.add(&quot;a&quot;);</span></span>
<span class="line"><span>			datas1.add(&quot;b&quot;);</span></span>
<span class="line"><span>			Map&lt;String, Object&gt; vars = new HashMap&lt;String, Object&gt;();</span></span>
<span class="line"><span>			vars.put(&quot;datas1&quot;, datas1);</span></span>
<span class="line"><span>			ProcessInstance pi = runtimeService.startProcessInstanceByKey(</span></span>
<span class="line"><span>				&quot;process1&quot;, vars);</span></span>
<span class="line"><span>		3.获取循环元素</span></span>
<span class="line"><span>			&lt;multiInstanceLoopCharacteristics</span></span>
<span class="line"><span>				isSequential=&quot;true&quot; activiti:collection=&quot;datas1&quot;</span></span>
<span class="line"><span>				activiti:elementVariable=&quot;data&quot;&gt;</span></span>
<span class="line"><span>			&lt;/multiInstanceLoopCharacteristics&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>			public class ServiceB implements JavaDelegate {</span></span>
<span class="line"><span></span></span>
<span class="line"><span>				public void execute(DelegateExecution execution) {</span></span>
<span class="line"><span>				</span></span>
<span class="line"><span>					System.out.println(&quot;获取循环参数：&quot; + execution.getVariable(&quot;data&quot;));</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		4.循环的内置参数</span></span>
<span class="line"><span>			nrOfInstances:实例总数</span></span>
<span class="line"><span>			nrOfActiveInstances:当前正在执行的实例总数	</span></span>
<span class="line"><span>			nrOfCompletedInstances:已经完成的实例总数</span></span>
<span class="line"><span>			loopCounter:当前循环的索引</span></span>
<span class="line"><span>		5.循环结束条件</span></span>
<span class="line"><span>			&lt;completionCondition&gt;${nrOfCompletedInstances &gt;= 2}&lt;/completionCondition&gt;</span></span>
<span class="line"><span>			</span></span>
<span class="line"><span>			&lt;multiInstanceLoopCharacteristics</span></span>
<span class="line"><span>				isSequential=&quot;true&quot; activiti:collection=&quot;${datas}&quot;</span></span>
<span class="line"><span>				activiti:elementVariable=&quot;data&quot;&gt;</span></span>
<span class="line"><span>				&lt;completionCondition&gt;${nrOfCompletedInstances &gt;= 2}&lt;/completionCondition&gt;</span></span>
<span class="line"><span>			&lt;/multiInstanceLoopCharacteristics&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第十四章 Activiti与规则引擎			</span></span>
<span class="line"><span>	1.Drools介绍与运行</span></span>
<span class="line"><span>		代码与业务规则分离</span></span>
<span class="line"><span>	2.规则语法</span></span>
<span class="line"><span>		全局变量</span></span>
<span class="line"><span>		函数</span></span>
<span class="line"><span>		规则属性</span></span>
<span class="line"><span>			activation-group 激活组，组内只有一个规则会被激活</span></span>
<span class="line"><span>			salience 优先级</span></span>
<span class="line"><span>		条件语法</span></span>
<span class="line"><span>			when then</span></span>
<span class="line"><span>		行为语法</span></span>
<span class="line"><span>			修改事实对象</span></span>
<span class="line"><span>			insert</span></span>
<span class="line"><span>			update</span></span>
<span class="line"><span>	3.Activiti整合Drools</span></span>
<span class="line"><span>		&lt;property name=&quot;customPostDeployers&quot;&gt;</span></span>
<span class="line"><span>			&lt;list&gt;</span></span>
<span class="line"><span>				&lt;bean class=&quot;org.activiti.engine.impl.rules.RulesDeployer&quot; /&gt;</span></span>
<span class="line"><span>			&lt;/list&gt;</span></span>
<span class="line"><span>		&lt;/property&gt;	</span></span>
<span class="line"><span>		</span></span>
<span class="line"><span>		&lt;businessRuleTask id=&quot;businessruletask1&quot; name=&quot;匹配销售规则&quot; </span></span>
<span class="line"><span>			activiti:ruleVariablesInput=&quot;${member}&quot; </span></span>
<span class="line"><span>			activiti:resultVariable=&quot;members&quot;&gt; &lt;/businessRuleTask&gt;</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第十五章 基于DMN的Activiti规则引擎</span></span>
<span class="line"><span>	1.DMN规范</span></span>
<span class="line"><span>	2.规则引擎使用</span></span>
<span class="line"><span>	3.MVEL表达式</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第十六章 整合第三方框架</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>	引擎，各种服务，都可以直接注入</span></span>
<span class="line"><span></span></span>
<span class="line"><span>第十七章 Rest</span></span>
<span class="line"><span>	</span></span>
<span class="line"><span>第十八章 </span></span>
<span class="line"><span>	表单</span></span>
<span class="line"><span>	流程图与XML的转换</span></span>
<span class="line"><span>	回退</span></span>
<span class="line"><span>	会签</span></span></code></pre></div></div></div></main><footer class="VPDocFooter" data-v-3ddcd6ca data-v-b34a43d1><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-b34a43d1><span class="visually-hidden" id="doc-footer-aria-label" data-v-b34a43d1>Pager</span><div class="pager" data-v-b34a43d1><!----></div><div class="pager" data-v-b34a43d1><a class="VPLink link pager-link next" href="/notes/be/tech-stack/tool/vitepress-blog.html" data-v-b34a43d1><!--[--><span class="desc" data-v-b34a43d1>Next page</span><span class="title" data-v-b34a43d1>搭建vitepress博客</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-4e0580c9 data-v-9192b3dc><div class="container" data-v-9192b3dc><p class="message" data-v-9192b3dc>Released under the MIT License.</p><p class="copyright" data-v-9192b3dc>Copyright © 2019-present Alooc</p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"about_me.md\":\"Bt5abNlO\",\"index.md\":\"CKi40Lzo\",\"notes_basics_algo_algo-metrics-and-sorting.md\":\"DXfnhhMc\",\"notes_basics_algo_basic-algorithms.md\":\"COa44KVb\",\"notes_basics_algo_basic-data-structures.md\":\"BTlcjSSa\",\"notes_basics_algo_index.md\":\"C9qZioem\",\"notes_basics_database_index.md\":\"D3oMsRGt\",\"notes_basics_database_mysql_example.md\":\"D5tcWHfF\",\"notes_basics_database_mysql_index.md\":\"DYz-oj6G\",\"notes_basics_database_nosql_mongodb_mongodb.md\":\"HTBQnDcX\",\"notes_basics_database_oracle_index.md\":\"CV9v1je5\",\"notes_basics_database_redis_index.md\":\"BiJjlPOU\",\"notes_basics_lang_htmlcssjs_css世界学习笔记.md\":\"B15NlFov\",\"notes_basics_lang_htmlcssjs_javascript笔记.md\":\"BAlOENdA\",\"notes_basics_lang_htmlcssjs_javascript高级程序设计学习笔记.md\":\"NGWdkHBG\",\"notes_basics_lang_htmlcssjs_jquery_ajax笔记.md\":\"CxmM5EIW\",\"notes_basics_lang_htmlcssjs_疯狂html5_css3_javascript讲义笔记.md\":\"DmrU1CDy\",\"notes_basics_lang_htmlcssjs_疯狂前端开发讲义笔记.md\":\"CTKwZ7yn\",\"notes_basics_lang_index.md\":\"BAnKyM_h\",\"notes_basics_lang_java_index.md\":\"Cg_Ll8dp\",\"notes_basics_lang_java_jsp_servlet笔记.md\":\"vxIZt5f7\",\"notes_basics_lang_java_juc.md\":\"CRJDwtum\",\"notes_basics_lang_java_学习笔记《java开发手册》.md\":\"DCAW8gvb\",\"notes_basics_lang_java_学习笔记《疯狂java讲义》.md\":\"fcpEhKwa\",\"notes_basics_lang_java_学习笔记《码出高效：java开发手册》.md\":\"DEru9gEe\",\"notes_basics_lang_java_抽象类和接口.md\":\"DrGgar7L\",\"notes_basics_lang_java_集合.md\":\"qEVm0dYV\",\"notes_basics_lang_python_note.md\":\"CrGfvPMo\",\"notes_be_frame_index.md\":\"Gkwa4ToL\",\"notes_be_frame_mybatis_index.md\":\"Dc24dPZN\",\"notes_be_frame_mybatisplus_index.md\":\"Cv4gkZan\",\"notes_be_frame_spring_spring_index.md\":\"Dh3eFJls\",\"notes_be_frame_spring_springboot_index.md\":\"DphekweS\",\"notes_be_frame_spring_springboot_source-analysis.md\":\"CR_aML-V\",\"notes_be_frame_spring_springcloud_index.md\":\"CGsKpwYa\",\"notes_be_frame_spring_springmvc_index.md\":\"DAyJBpEu\",\"notes_be_middleware_elk_elasticsearch.md\":\"D_wVi8oM\",\"notes_be_middleware_index.md\":\"DxYRG15x\",\"notes_be_middleware_rabbitmq_rabbitmq.md\":\"Dxx68ID5\",\"notes_be_tech-stack_activiti_activiti6.md\":\"4j5kN20m\",\"notes_be_tech-stack_android_第一行代码笔记.md\":\"2TiKtwog\",\"notes_be_tech-stack_bash_bash基础笔记.md\":\"Dqb5uNvS\",\"notes_be_tech-stack_bash_常用命令.md\":\"B3x7eLx0\",\"notes_be_tech-stack_design-pattern.md\":\"Ro0IZ1lt\",\"notes_be_tech-stack_docker_docker命令.md\":\"DnQRIMLQ\",\"notes_be_tech-stack_docker_常用镜像命令.md\":\"BAdQoNKD\",\"notes_be_tech-stack_index.md\":\"Bfo6JBoO\",\"notes_be_tech-stack_maven_maven深入学习笔记.md\":\"Bjwsvikh\",\"notes_be_tech-stack_swagger_swagger.md\":\"Bz19yL2w\",\"notes_be_tech-stack_tool_vitepress-blog.md\":\"T-Uo5JZR\",\"notes_be_tech-stack_yaml_yaml语法.md\":\"B9M2ZYi_\",\"notes_be_tech-stack_技巧.md\":\"CaMeyKvU\",\"notes_fe_data-visualization_guide_canvas.md\":\"mR9mzqqB\",\"notes_fe_data-visualization_guide_echarts-basic.md\":\"CUcKljj7\",\"notes_fe_data-visualization_guide_echarts.md\":\"YhqaWGPI\",\"notes_fe_data-visualization_guide_scene.md\":\"D6XwnhMR\",\"notes_fe_data-visualization_guide_svg.md\":\"CKone4My\",\"notes_fe_data-visualization_guide_tech.md\":\"B3diwLiE\",\"notes_fe_data-visualization_instruction.md\":\"W7tp4lUK\",\"notes_fe_data-visualization_readme.md\":\"Bw0IeGoH\",\"notes_fe_data-visualization_report_guide.md\":\"BtPZhK3R\",\"notes_fe_data-visualization_report_intro.md\":\"vQRnrh8g\",\"notes_fe_data-visualization_report_qa.md\":\"CjGZSG_J\",\"notes_fe_data-visualization_report_summary.md\":\"CVMkEcd2\",\"notes_fe_index.md\":\"B6HjWv2Y\",\"notes_fe_websocket_基础总结.md\":\"DB4nlgYP\",\"projects_mall_index.md\":\"BaAe1Q9T\",\"projects_preview_api-examples.md\":\"DK13Sa_n\",\"projects_preview_index.md\":\"Dz8tC6Rf\",\"projects_preview_markdown-examples.md\":\"DaWRO3Oq\",\"projects_springcloud项目尚医通总结.md\":\"Du9k6TLQ\",\"refs_blogs_index.md\":\"B9WZ4Rmw\",\"refs_docs_index.md\":\"CQm2K5dV\",\"refs_tutorials_index.md\":\"DC92EBbN\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"Alooc\",\"description\":\"Alooc的博客\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.png\",\"nav\":[{\"text\":\"首页\",\"link\":\"/\"},{\"text\":\"我的笔记\",\"items\":[{\"text\":\"基础\",\"items\":[{\"text\":\"算法\",\"link\":\"/notes/basics/algo/algo-metrics-and-sorting\"},{\"text\":\"数据库\",\"link\":\"/notes/basics/database/mysql/\"},{\"text\":\"编程语言\",\"link\":\"/notes/basics/lang/java/\"}]},{\"text\":\"后端\",\"items\":[{\"text\":\"框架\",\"link\":\"/notes/be/frame/spring/spring/\"},{\"text\":\"中间件\",\"link\":\"/notes/be/middleware/rabbitmq/rabbitmq\"},{\"text\":\"技术栈\",\"link\":\"/notes/be/tech-stack/design-pattern\"}]},{\"text\":\"前端\",\"link\":\"/notes/fe/data-visualization/instruction\"}]},{\"text\":\"项目实践\",\"items\":[{\"text\":\"在线预览\",\"link\":\"/projects/preview/markdown-examples\"},{\"text\":\"商城系统\",\"link\":\"/projects/mall/\"}]},{\"text\":\"参考资料\",\"items\":[{\"text\":\"博客\",\"link\":\"/refs/blogs/\"},{\"text\":\"文档\",\"link\":\"/refs/docs/\"},{\"text\":\"教程\",\"link\":\"/refs/tutorials/\"}]},{\"text\":\"关于我\",\"link\":\"/about/me/\"}],\"sidebar\":{\"/notes/basics/algo/\":[{\"text\":\"算法\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/notes/basics/database/\":[{\"text\":\"数据库\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/notes/basics/lang/\":[{\"text\":\"语言\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/notes/be/frame/\":[{\"text\":\"框架\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/notes/be/middleware/\":[{\"text\":\"中间件\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/notes/be/tech-stack/\":[{\"text\":\"技术栈\",\"items\":[{\"text\":\"工具\",\"items\":[{\"text\":\"搭建vitepress博客\",\"link\":\"/notes/be/tech-stack/tool/vitepress-blog\"}]}]}],\"/notes/fe/\":[{\"text\":\"前端\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/projects/preview/\":[{\"text\":\"在线预览\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/projects/\":[{\"text\":\"项目\",\"items\":[{\"text\":\"电商项目\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/refs/blogs/\":[{\"text\":\"博客\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}],\"/refs/docs/\":[{\"text\":\"文档\",\"items\":[{\"text\":\"测试\",\"link\":\"/refs/docs/redis.html\"}]}],\"/refs/tutorials/\":[{\"text\":\"教程\",\"items\":[{\"text\":\"测试\",\"link\":\"/projects/preview/markdown-examples\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/alooc\"}],\"footer\":{\"message\":\"Released under the MIT License.\",\"copyright\":\"Copyright © 2019-present Alooc\"},\"search\":{\"provider\":\"local\"},\"outline\":{\"level\":[1,6],\"label\":\"页面导航\"}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false}");</script>
    
  </body>
</html>